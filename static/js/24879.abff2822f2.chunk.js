"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[24879],{657412:(e,t,r)=>{r.d(t,{Xp:()=>a.Xp,yZ:()=>useBrowserAction,Gd:()=>useBrowserBookmarkAction,cS:()=>useBrowserHistoryAction,AO:()=>useBrowserTabActions,AS:()=>a.AS,Do:()=>a.Do,pJ:()=>a.pJ,nD:()=>a.nD});var a=r(603614),n=r(586330),o=r(324586),i=r(946343),s=r.n(i),l=r(230414),c=r(929296),u=r(195309),d=r(972715),b=r(514041),f=r(490343),p=r(60153),m=r(262873),y=r(714178),v=r(971670),g=r(660015),k=r(254491),w=r(849726),h=r(213644),D=(r(663522),r(757559)),T=r(657355),A=r(482407),B=r(796151),S=r(42484);function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){(0,o.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _createSuper(e){var t=_isNativeReflectConstruct();return function _createSuperInternal(){var r,a=(0,d.A)(e);if(t){var n=(0,d.A)(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return(0,u.A)(this,r)}}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function loggerForEmptyData(e,t){e&&0!==e.length||(h.U.discovery.browser.setTabsDataFunctionName(t),h.U.discovery.browser.tabsData(e))}var W={};var I={id:"home",url:"about:blank",title:"OneKey",canGoBack:!1,loading:!1,favicon:""},j=function(e){(0,c.A)(ContextJotaiActionsDiscovery,e);var t=_createSuper(ContextJotaiActionsDiscovery);function ContextJotaiActionsDiscovery(...e){var r,o,i,l,c,u,d,b,y;return(r=t.call(this,...e)).setDisplayHomePage=(0,a.q0)((function(e,t,r){t((0,a.QL)(),r)})),r.setBrowserDataReady=(0,a.q0)((function(e,t){t((0,a.lr)(),!0)})),r.buildWebTabs=(0,a.q0)((function(e,t,r){var{data:n,options:o}=r;if(e((0,a.lr)())||o?.isInitFromStorage){var i=e((0,a.cl)()),l=n;if(!Array.isArray(n))throw new Error("setWebTabsWriteAtom: payload must be an array");l&&l.length||(l=[]);var c=function buildWebTabData(e){var t={},r=[];return e.sort((function(e,t){return e.timestamp&&t.timestamp?e.timestamp-t.timestamp:0})),e.forEach((function(e){r.push(e.id),t[e.id]=e})),{data:e,keys:r,map:t}}(l);s()(c.keys,i.keys)&&!o?.forceUpdate||t((0,a.cl)(),{keys:c.keys,tabs:c.data}),t((0,a.GW)(),(function(){return c.map})),loggerForEmptyData(c.data,"buildWebTabs->saveToSimpleDB"),p.A.simpleDb.browserTabs.setRawData({tabs:c.data})}})),r.refreshTabs=(0,a.q0)((function(e,t){var{tabs:n}=e((0,a.cl)()),o=[...n];loggerForEmptyData(o,"refreshTabs"),r.buildWebTabs.call(t,{data:o,options:{forceUpdate:!0}})})),r.setCurrentWebTab=(0,a.q0)((function(e,t,n){var o=e((0,a.WL)());if(o!==n){r.pauseDappInteraction.call(t,o);var{tabs:i}=e((0,a.cl)()),s=i.findIndex((function(e){return e.id===n}));i.forEach((function(e){e.isActive=!1})),loggerForEmptyData([...i],"setCurrentWebTab"),r.buildWebTabs.call(t,{data:[...i]}),-1!==s?(i[s].isActive=!0,t((0,a.WL)(),n),r.resumeDappInteraction.call(t,n)):t((0,a.WL)(),"")}var l=e((0,a.QL)());n&&l&&r.setDisplayHomePage.call(t,!1),n||l||r.setDisplayHomePage.call(t,!0)})),r.addWebTab=(0,a.q0)((function(e,t,n){performance.now();var o,{tabs:i}=e((0,a.cl)());n.id&&n.id!==I.id||(n.id=(0,A.lk)()),n.timestamp=Date.now(),r.buildWebTabs.call(t,{data:[...i,n]}),r.setCurrentWebTab.call(t,null!=(o=n.id)?o:"");performance.now()})),r.addBlankWebTab=(0,a.q0)((function(e,t){r.addWebTab.call(t,_objectSpread(_objectSpread({},I),{},{isActive:!0}))})),r.setWebTabData=(0,a.q0)((function(e,t,n){var{tabs:o}=e((0,a.cl)()),i=o,s=i.findIndex((function(e){return e.id===n.id}));if(s>-1){var l=i[s];Object.keys(n).forEach((function(e){var t=e,r=n[t];if(void 0!==r&&r!==l[t]){if("title"===t&&!r)return;l[t]=r,"url"===t&&(l.timestamp=Date.now(),"about:blank"===r&&n.id&&(W[n.id]=l.timestamp))}})),i[s]=l,loggerForEmptyData(i,"setWebTabData"),r.buildWebTabs.call(t,{data:i})}})),r.closeWebTab=(0,a.q0)((function(e,t,n){delete g.O3[n];var{tabs:o}=e((0,a.cl)()),i=e((0,a.WL)()),s=o.findIndex((function(e){return e.id===n}));if(-1!==s){var l=o[s].id===i;if(o.splice(s,1),l){var c=s-1;if(c<0&&o.length>0&&(c=0),c>=0){var u=o[c];u.isActive=!0,r.setCurrentWebTab.call(t,u.id)}}}loggerForEmptyData([...o],"closeWebTab"),r.buildWebTabs.call(t,{data:[...o]})})),r.closeAllWebTabs=(0,a.q0)((function(e,t){var{tabs:n}=e((0,a.cl)()),o=e((0,a.WL)()),i=n.filter((function(e){return e.isPinned}));i.every((function(e){return e.id!==o}))&&r.setCurrentWebTab.call(t,null);var _loop=function(e){i.find((function(t){return t.id===e}))||delete g.O3[e]};for(var s of Object.getOwnPropertyNames(g.O3))_loop(s);loggerForEmptyData(i,"closeAllWebTabs"),r.buildWebTabs.call(t,{data:i})})),r.setPinnedTab=(0,a.q0)((function(e,t,a){r.setWebTabData.call(t,{id:a.id,isPinned:a.pinned,timestamp:Date.now()}),r.refreshTabs.call(t)})),r.syncBookmark=(0,a.q0)((function(e,t,n){var o=e((0,a.GW)());o&&Object.entries(o).forEach((function([,e]){e.url===n.url&&r.setWebTabData.call(t,{id:e.id,isBookmark:n.isBookmark})}))})),r.getBookmarkData=(0,a.q0)((0,n.A)((function*(){var e;return null!=(e=(yield p.A.simpleDb.browserBookmarks.getRawData())?.data)?e:[]}))),r.buildBookmarkData=(0,a.q0)((function(e,t,r){var{data:n,options:o}=r;if(e((0,a.lr)())||o?.isInitFromStorage){if(!Array.isArray(n))throw new Error("buildBookmarkData: payload must be an array");p.A.serviceDiscovery.setBrowserBookmarks(n)}})),r.addBrowserBookmark=(0,a.q0)((o=(0,n.A)((function*(e,t,a){if(a.url&&a.url!==I.url){var n=[...(yield r.getBookmarkData.call(t)).filter((function(e){return e.url!==a.url})),{url:a.url,title:a.title}];r.buildBookmarkData.call(t,{data:n}),r.syncBookmark.call(t,{url:a.url,isBookmark:!0}),p.A.serviceCloudBackup.requestAutoBackup()}})),function(e,t,r){return o.apply(this,arguments)})),r.removeBrowserBookmark=(0,a.q0)((i=(0,n.A)((function*(e,t,a){var n=(yield r.getBookmarkData.call(t)).filter((function(e){return e.url!==a}));r.buildBookmarkData.call(t,{data:n}),r.syncBookmark.call(t,{url:a,isBookmark:!1})})),function(e,t,r){return i.apply(this,arguments)})),r.modifyBrowserBookmark=(0,a.q0)((l=(0,n.A)((function*(e,t,a){if(a.url&&a.url!==I.url){var n=(yield r.getBookmarkData.call(t)).map((function(e){return e.url===a.url?_objectSpread(_objectSpread({},e),a):e}));r.buildBookmarkData.call(t,{data:n})}})),function(e,t,r){return l.apply(this,arguments)})),r.getHistoryData=(0,a.q0)((0,n.A)((function*(){var e;return null!=(e=(yield p.A.simpleDb.browserHistory.getRawData())?.data)?e:[]}))),r.buildHistoryData=(0,a.q0)((function(e,t,r){var{data:n,options:o}=r;if(e((0,a.lr)())||o?.isInitFromStorage){if(!Array.isArray(n))throw new Error("buildHistoryData: payload must be an array");p.A.simpleDb.browserHistory.setRawData({data:n})}})),r.addBrowserHistory=(0,a.q0)((c=(0,n.A)((function*(e,t,a){if(a.url&&a.url!==I.url){var n=(yield r.getHistoryData.call(t)).filter((function(e){return e.url!==a.url})),o={id:(0,A.lk)(),url:a.url,title:a.title,createdAt:Date.now()};r.buildHistoryData.call(t,{data:[o,...n]})}})),function(e,t,r){return c.apply(this,arguments)})),r.removeBrowserHistory=(0,a.q0)((u=(0,n.A)((function*(e,t,a){var n=(yield r.getHistoryData.call(t)).filter((function(e){return e.id!==a}));r.buildHistoryData.call(t,{data:n})})),function(e,t,r){return u.apply(this,arguments)})),r.removeAllBrowserHistory=(0,a.q0)((d=(0,n.A)((function*(e,t){r.buildHistoryData.call(t,{data:[]})})),function(e,t){return d.apply(this,arguments)})),r.getWebTabById=(0,a.q0)((function(e,t,r){var n=e((0,a.GW)());return n?.[r||""]})),r.gotoSite=(0,a.q0)((b=(0,n.A)((function*(e,t,{id:a,url:n,title:o,favicon:i,isNewWindow:s,isInPlace:l,userTriggered:c}){var u=r.getWebTabById.call(t,null!=a?a:"");if(n){var d=B.Ay.validateUrl(n);if(!d)return;if(c&&r.addBrowserHistory.call(t,{url:d,title:null!=o?o:""}),"StandardBrowser"===g.n5)return(0,v.C)(d);var b=u?.id,f=!d.startsWith("http")&&"about:blank"!==d,p="boolean"==typeof s?s:(s||!b||"home"===b||f)&&"MultiTabBrowser"===g.n5,m=yield r.getBookmarkData.call(t),y=m?.some((function(e){return e.url.includes(d)}));return p?r.addWebTab.call(t,{title:o,url:d,favicon:i,isBookmark:y}):r.setWebTabData.call(t,{id:b,url:d,title:o,favicon:i,isBookmark:y}),p||l||(0,g.T0)({url:d,tabId:b}),f&&"MultiTabBrowser"===g.n5&&b&&setTimeout((function(){r.closeWebTab.call(t,b)}),1e3),!0}return!1})),function(e,t,r){return b.apply(this,arguments)})),r.openMatchDApp=(0,a.q0)((y=(0,n.A)((function*(e,t,{dApp:a,webSite:n,isNewWindow:o,tabId:i}){return n?r.gotoSite.call(t,{id:i,url:n.url,title:n.title,favicon:yield p.A.serviceDiscovery.buildWebsiteIconUrl(n.url),isNewWindow:o,userTriggered:!0}):a?r.gotoSite.call(t,{id:i,url:a.url,title:a.name,dAppId:a.dappId,favicon:a.logo||a.originLogo,userTriggered:!0,isNewWindow:o}):void 0})),function(e,t,r){return y.apply(this,arguments)})),r.handleOpenWebSite=(0,a.q0)((function(e,t,{useCurrentWindow:n,tabId:o,navigation:i,webSite:s,dApp:l,shouldPopNavigation:c=!0}){var u=!n;if(!n&&e((0,a.$D)()))return void f.Toast.message({title:w.a.intl.formatMessage({id:k.ETranslations.explore_toast_tab_limit_reached},{number:"20"})});r.setDisplayHomePage.call(t,!1),r.openMatchDApp.call(t,{webSite:s,dApp:l,isNewWindow:u,tabId:o}),c&&i.switchTab(D.V4.Discovery)})),r.onNavigation=(0,a.q0)((function(e,t,{url:n,isNewWindow:o,isInPlace:i,title:s,favicon:l,canGoBack:c,canGoForward:u,loading:d,id:b,handlePhishingUrl:f}){var p=Date.now(),y=r.getWebTabById.call(t,null!=b?b:"");if(y){var v="string"==typeof n&&n!==y.url;if(n){var g=e((0,a.RY)()),{action:k}=B.Ay.parseDappRedirect(n,Array.from(g.keys()));if(k===B.Ay.EDAppOpenActionEnum.DENY)return h.U.discovery.browser.logRejectUrl(n),void f?.(n);if(B.Ay.isValidDeepLink(n))return void(0,m.q)({url:n})}if(v){if(y.timestamp&&p-y.timestamp<500)return;if(W[y.id]&&n!==I.url&&p-W[y.id]<1e3)return;r.gotoSite.call(t,{url:n,title:s,favicon:l,isNewWindow:o,isInPlace:i,id:y.id})}r.setWebTabData.call(t,{id:y.id,title:s,favicon:l,canGoBack:c,canGoForward:u,loading:d})}})),r.addUrlToPhishingCache=(0,a.q0)((function(e,t,r){try{var{origin:n}=new URL(r.url),o=e((0,a.RY)());o.set(n,!0),t((0,a.RY)(),o),window.desktopApi?.setAllowedPhishingUrls(Array.from(o.keys()))}catch{}})),r.updateDappActivityInteraction=(0,a.q0)((function(e,t,r){var n=r.id;n||(n=e((0,a.WL)()));var o=n?g.O3[n]:null;if(o){var i="pause"===r.type;i?g.ay:g.F;o.jsBridge&&(o.jsBridge.globalOnMessageEnabled=!i)}})),r.pauseDappInteraction=(0,a.q0)((function(e,t,a){r.updateDappActivityInteraction.call(t,{id:a,type:"pause"})})),r.resumeDappInteraction=(0,a.q0)((function(e,t,a){r.updateDappActivityInteraction.call(t,{id:a,type:"resume"})})),r.validateWebviewSrc=(0,a.q0)((function(e,t,r){if(!r)return S.i.InvalidUrl;var n=e((0,a.RY)()),{action:o}=B.Ay.parseDappRedirect(r,Array.from(n.keys()));return o===B.Ay.EDAppOpenActionEnum.DENY?(h.U.discovery.browser.logRejectUrl(r),S.i.NotSupportProtocol):B.Ay.containsPunycode(r)?(h.U.discovery.browser.logRejectUrl(r),S.i.InvalidPunycode):B.Ay.isValidDeepLink(r)?S.i.ValidDeeplink:S.i.Valid})),r}return(0,l.A)(ContextJotaiActionsDiscovery)}(y.x),x=(0,T.j)((function(){return new j}));function useBrowserTabActions(){var e=x(),t=e.addWebTab.use(),r=e.addBlankWebTab.use(),a=e.buildWebTabs.use(),n=e.refreshTabs.use(),o=e.setWebTabData.use(),i=e.getWebTabById.use(),s=e.closeWebTab.use(),l=e.closeAllWebTabs.use(),c=e.setCurrentWebTab.use(),u=e.setPinnedTab.use(),d=e.setDisplayHomePage.use(),f=e.setBrowserDataReady.use();return(0,b.useRef)({addWebTab:t,addBlankWebTab:r,buildWebTabs:a,refreshTabs:n,setWebTabData:o,getWebTabById:i,closeWebTab:s,closeAllWebTabs:l,setCurrentWebTab:c,setPinnedTab:u,setDisplayHomePage:d,setBrowserDataReady:f})}function useBrowserBookmarkAction(){var e=x(),t=e.buildBookmarkData.use(),r=e.getBookmarkData.use(),a=e.addBrowserBookmark.use(),n=e.removeBrowserBookmark.use(),o=e.modifyBrowserBookmark.use();return(0,b.useRef)({buildBookmarkData:t,getBookmarkData:r,addBrowserBookmark:a,removeBrowserBookmark:n,modifyBrowserBookmark:o})}function useBrowserHistoryAction(){var e=x(),t=e.buildHistoryData.use(),r=e.getHistoryData.use(),a=e.addBrowserHistory.use(),n=e.removeBrowserHistory.use(),o=e.removeAllBrowserHistory.use();return(0,b.useRef)({buildHistoryData:t,getHistoryData:r,addBrowserHistory:a,removeBrowserHistory:n,removeAllBrowserHistory:o})}function useBrowserAction(){var e=x(),t=e.gotoSite.use(),r=e.openMatchDApp.use(),a=e.handleOpenWebSite.use(),n=e.onNavigation.use(),o=e.addUrlToPhishingCache.use(),i=e.pauseDappInteraction.use(),s=e.resumeDappInteraction.use(),l=e.validateWebviewSrc.use();return(0,b.useRef)({gotoSite:t,openMatchDApp:r,handleOpenWebSite:a,onNavigation:n,addUrlToPhishingCache:o,pauseDappInteraction:i,resumeDappInteraction:s,validateWebviewSrc:l})}},574319:(e,t,r)=>{r.d(t,{D$:()=>useWebTabDataById,bI:()=>useDisabledAddedNewTab,cf:()=>useActiveTabId,oM:()=>useWebTabs,y:()=>useDisplayHomePageFlag});var a=r(514041),n=r(657412),useWebTabs=function(){var[e]=(0,n.pJ)();return(0,a.useMemo)((function(){return{tabs:e.tabs}}),[e])},useWebTabDataById=function(e){var[t]=(0,n.nD)();return(0,a.useMemo)((function(){return{tab:t[null!=e?e:""]}}),[t,e])},useActiveTabId=function(){var[e]=(0,n.Xp)();return(0,a.useMemo)((function(){return{activeTabId:e}}),[e])},useDisplayHomePageFlag=function(){var[e]=(0,n.Do)();return{displayHomePage:e}},useDisabledAddedNewTab=function(){var[e]=(0,n.AS)();return(0,a.useMemo)((function(){return{disabledAddedNewTab:e}}),[e])}},224879:(e,t,r)=>{r.r(t),r.d(t,{default:()=>T,tabGridRefs:()=>D});var a=r(324586),n=r(514041),o=r(908867),i=r(17617),s=r(490343),l=r(498356),c=r(657412),u=r(254491),d=r(757559),b=r(574319),f=r(831085);const p=function MobileTabListItem({id:e,activeTabId:t,onSelectedItem:r,onCloseItem:a,onLongPress:n}){var{tab:o}=(0,b.D$)(e),l=t===e;return(0,f.jsx)(s.Stack,{width:"100%",onPress:function(){r(e)},onLongPress:function(){n(e)},p:"$1",animation:"quick",pressStyle:{scale:.95},testID:`tab-modal-list-item-${e}`,children:(0,f.jsx)(s.Stack,{borderRadius:"$4",borderWidth:"$1",borderColor:l?"$brand6":"$transparent",p:"$0.5",borderCurve:"continuous",testID:l?`tab-modal-active-item-${e}`:`tab-modal-no-active-item-${e}`,children:(0,f.jsxs)(s.Group,{borderRadius:"$2.5",borderWidth:i.A.hairlineWidth,borderColor:"$borderSubdued",separator:(0,f.jsx)(s.Divider,{}),children:[(0,f.jsx)(s.Group.Item,{children:(0,f.jsxs)(s.XStack,{py:"$2",pl:"$2.5",pr:"$2",alignItems:"center",bg:"$bgSubdued",borderCurve:"continuous",children:[(0,f.jsxs)(s.Image,{size:"$4",borderRadius:"$1",children:[(0,f.jsx)(s.Image.Source,{src:o?.favicon}),(0,f.jsx)(s.Image.Fallback,{children:(0,f.jsx)(s.Icon,{name:"GlobusOutline",size:"$4"})}),(0,f.jsx)(s.Image.Loading,{children:(0,f.jsx)(s.Skeleton,{width:"100%",height:"100%"})})]}),(0,f.jsx)(s.SizableText,{flex:1,size:"$bodySm",textAlign:"left",numberOfLines:1,mx:"$2",children:o?.title||""}),(0,f.jsx)(s.IconButton,{variant:"tertiary",size:"small",icon:"CrossedSmallOutline",onPress:function(){return a(e)},testID:`tab-modal-header-close-${e}`})]})}),(0,f.jsx)(s.Group.Item,{children:(0,f.jsx)(s.Stack,{pb:"100%",children:(0,f.jsx)(s.Stack,{position:"absolute",left:0,top:0,right:0,bottom:0,children:(0,f.jsx)(s.Image,{w:"100%",h:"100%",borderBottomLeftRadius:10,borderBottomRightRadius:10,children:(0,f.jsx)(s.Image.Source,{source:{uri:o?.thumbnail}})})})})})]})})})};const m=function MobileTabListPinnedItem({id:e,activeTabId:t,onSelectedItem:r,onLongPress:a}){var{tab:n}=(0,b.D$)(e),o=t===e;return(0,f.jsx)(s.Stack,{p:"$0.5",minWidth:"$28",maxWidth:"$40",borderRadius:"$4",borderWidth:4,borderColor:o?"$brand6":"$transparent",marginHorizontal:2,onPress:function(){r(e)},onLongPress:function(){a(e)},animation:"quick",pressStyle:{scale:.95},children:(0,f.jsxs)(s.XStack,{bg:"$bgStrong",p:"$2",alignItems:"center",borderRadius:"$2.5",testID:`tab-list-stack-pinned-${e}`,children:[(0,f.jsxs)(s.Image,{size:"$4",borderRadius:"$1",children:[(0,f.jsx)(s.Image.Source,{src:n?.favicon}),(0,f.jsx)(s.Image.Fallback,{delayMs:100,children:(0,f.jsx)(s.Icon,{name:"GlobusOutline",size:"$4"})}),(0,f.jsx)(s.Image.Loading,{children:(0,f.jsx)(s.Skeleton,{width:"100%",height:"100%"})})]}),(0,f.jsx)(s.SizableText,{flex:1,size:"$bodySm",numberOfLines:1,ml:"$2",children:n?.title||""})]})})};var y=r(416526),v=r(670656),g=(y.A.get("window").width,y.A.get("window").width,v.A.get(),r(684358)),k=r(663522);const w=function useBrowserOptionsAction(){return{handleShareUrl:(0,n.useCallback)((function(e){if(!e)throw new Error("url is required");setTimeout((function(){g.A.share(k.Ay.isNativeIOS?{url:e}:{message:e})}),300)}),[])}};var h=r(564452);function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){(0,a.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var D={};function TabToolBar({closeAllDisabled:e,onAddTab:t,onCloseAll:r,onDone:a}){var n=(0,o.A)();return(0,f.jsxs)(s.Stack,{py:"$2",flexDirection:"row",alignItems:"center",borderTopWidth:i.A.hairlineWidth,borderTopColor:"$borderSubdued",children:[(0,f.jsx)(s.Stack,{flex:1,alignItems:"center",justifyContent:"center",children:(0,f.jsx)(s.Button,{variant:"tertiary",size:"medium",onPress:r,disabled:e,testID:"tab-list-modal-close-all",children:n.formatMessage({id:u.ETranslations.explore_close_all})})}),(0,f.jsx)(s.Stack,{flex:1,alignItems:"center",justifyContent:"center",children:(0,f.jsx)(s.IconButton,{variant:"secondary",size:"medium",icon:"PlusLargeOutline",testID:"browser-bar-add",onPress:t})}),(0,f.jsx)(s.Stack,{flex:1,alignItems:"center",justifyContent:"center",children:(0,f.jsx)(s.Button,{variant:"tertiary",size:"medium",onPress:a,testID:"tab-list-modal-done",children:n.formatMessage({id:u.ETranslations.global_done})})})]})}const T=(0,h.k)((function MobileTabListModal(){var e,t=(0,o.A)(),r=(0,l.A)(),{tabs:a}=(0,b.oM)(),i=(0,n.useMemo)((function(){return(null!=a?a:[]).filter((function(e){return!e.isPinned}))}),[a]),y=(0,n.useMemo)((function(){return(null!=a?a:[]).filter((function(e){return e.isPinned}))}),[a]),{disabledAddedNewTab:v}=(0,b.bI)(),{activeTabId:g}=(0,b.cf)(),{addBrowserBookmark:k,removeBrowserBookmark:h}=(0,c.Gd)().current,{closeAllWebTabs:D,setCurrentWebTab:T,closeWebTab:A,setPinnedTab:B,setDisplayHomePage:S}=(0,c.AO)().current,W=(0,n.useRef)(!1);(0,n.useEffect)((function(){W.current&&!a.length&&(S(!0),r.pop()),W.current=!1}),[a,S,r]);var I=(0,n.useMemo)((function(){return i.findIndex((function(e){return e.id===g}))}),[i,g]),j=(0,n.useMemo)((function(){return y.findIndex((function(e){return e.id===g}))}),[y,g]),{handleShareUrl:x}=w(),P=(0,n.useCallback)((function(e,r,a){e?k({url:r,title:a}):h(r),s.Toast.success({title:e?t.formatMessage({id:u.ETranslations.explore_toast_bookmark_added}):t.formatMessage({id:u.ETranslations.explore_toast_bookmark_removed})})}),[k,h,t]),O=(0,n.useCallback)((function(e){x(e)}),[x]),$=(0,n.useCallback)((function(e,r){B({id:e,pinned:r}),s.Toast.success({title:r?t.formatMessage({id:u.ETranslations.explore_toast_pinned}):t.formatMessage({id:u.ETranslations.explore_toast_unpinned})})}),[B,t]),C=(0,n.useCallback)((function(e){W.current=!0,A(e)}),[A]),_=(0,n.useCallback)((function(){v?s.Toast.message({title:t.formatMessage({id:u.ETranslations.explore_toast_tab_limit_reached},{number:"20"})}):(r.pop(),setTimeout((function(){r.pushModal(d.ry.DiscoveryModal,{screen:d.v1.SearchModal})}),0))}),[v,r,t]),E=(0,n.useCallback)((function(e,r){s.ActionList.show({title:t.formatMessage({id:u.ETranslations.explore_options}),sections:[{items:[{label:t.formatMessage({id:e.isBookmark?u.ETranslations.explore_remove_bookmark:u.ETranslations.explore_add_bookmark}),icon:e.isBookmark?"StarSolid":"StarOutline",onPress:function(){var t;return P(!e.isBookmark,e.url,null!=(t=e.title)?t:"")},testID:"action-list-item-"+(e.isBookmark?"remove-bookmark":"bookmark")},{label:t.formatMessage({id:e.isPinned?u.ETranslations.explore_unpin:u.ETranslations.explore_pin}),icon:e.isPinned?"ThumbtackSolid":"ThumbtackOutline",onPress:function(){return $(r,!e.isPinned)},testID:"action-list-item-"+(e.isPinned?"un-pin":"pin")},{label:t.formatMessage({id:u.ETranslations.explore_share}),icon:"ShareOutline",onPress:function(){return O(e.url)},testID:"action-list-item-share"}]},{items:[{label:t.formatMessage({id:e.isPinned?u.ETranslations.explore_close_pin_tab:u.ETranslations.explore_close_tab}),icon:"CrossedLargeOutline",onPress:function(){return C(r)},testID:"action-list-item-close-"+(e.isPinned?"close-pin-tab":"close-tab")}]}]})}),[P,$,O,C,t]),H=(0,n.useCallback)((function(e){return e.id}),[]),R=(0,n.useCallback)((function({item:e}){return(0,f.jsx)(p,_objectSpread(_objectSpread({},e),{},{activeTabId:g,onSelectedItem:function(e){T(e),r.pop()},onCloseItem:C,onLongPress:function(t){E(e,t)}}))}),[g,C,T,r,E]),M=(0,n.useCallback)((function({item:e}){return(0,f.jsx)(m,_objectSpread(_objectSpread({},e),{},{activeTabId:g,onSelectedItem:function(e){T(e),r.pop()},onCloseItem:C,onLongPress:function(t){E(e,t)}}))}),[r,T,g,C,E]),q=(0,n.useMemo)((function(){return 0===y.length?null:(0,f.jsx)(s.BlurView,{position:"absolute",left:"$2.5",bottom:"$2.5",right:"$2.5",borderRadius:"$5",bg:"$bgStrong",testID:"tab-pined-container",experimentalBlurMethod:"none",children:(0,f.jsx)(s.ListView,{contentContainerStyle:{p:"$1"},horizontal:!0,data:y,showsHorizontalScrollIndicator:!1,keyExtractor:function(e){return e.id},estimatedItemSize:"$28",estimatedListSize:{width:370,height:52},renderItem:M,initialScrollIndex:j})})}),[y,M,j]);return(0,f.jsxs)(s.Page,{children:[(0,f.jsx)(s.Page.Header,{title:t.formatMessage({id:u.ETranslations.explore_tabs_count},{number:`${null!=(e=a.length)?e:0}`})}),(0,f.jsxs)(s.Page.Body,{children:[(0,f.jsx)(s.ListView,{initialScrollIndex:I,estimatedItemSize:223,data:i,renderItem:R,keyExtractor:H,numColumns:2,showsHorizontalScrollIndicator:!1,showsVerticalScrollIndicator:!1,contentContainerStyle:{paddingHorizontal:10,paddingBottom:62},testID:"tab-container"}),q]}),(0,f.jsx)(s.Page.Footer,{children:(0,f.jsx)(TabToolBar,{closeAllDisabled:i.length<=0,onAddTab:_,onCloseAll:function(){W.current=!0,D()},onDone:function(){r.pop()}})})]})}))},660015:(e,t,r)=>{r.d(t,{F:()=>s,Mr:()=>formatHiddenHttpsUrl,O3:()=>o,T0:()=>crossWebviewLoadUrl,ay:()=>i,n5:()=>n});var a=r(663522),n="StandardBrowser",o={};function getWebviewWrapperRef(e){var t=e?o[e]:null;return null!=t?t:null}function formatHiddenHttpsUrl(e){return{isHttpsUrl:e&&/^https/i.test(e),hiddenHttpsUrl:e?.replace?.(/^https:\/\//i,"")}}function crossWebviewLoadUrl({url:e,tabId:t}){var r=getWebviewWrapperRef(t);a.Ay.isRuntimeBrowser?r?.innerRef?.loadURL(e):r?.innerRef?.loadUrl(e)}var i="\n(function(){\n  if (window.WebSocket) {\n    if (!window.$$onekeyWebSocketSend) {\n      window.$$onekeyWebSocketSend = window.WebSocket.prototype.send;\n    }\n    window.WebSocket.prototype.send = () => {};\n  }\n})()\n",s="\n(function(){\n  if (\n    window.WebSocket &&\n    window.$$onekeyWebSocketSend\n  ) {\n    window.WebSocket.prototype.send = window.$$onekeyWebSocketSend;\n  }\n})()\n"}}]);
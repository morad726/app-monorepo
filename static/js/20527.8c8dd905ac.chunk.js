"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[20527],{326745:(e,r,t)=>{t.d(r,{u:()=>useAppRoute});var a=t(724249);function useAppRoute(){return(0,a.lq)()}},973066:(e,r,t)=>{t.d(r,{i:()=>FirmwareChangeLogContentView,z:()=>FirmwareChangeLogView});var a=t(586330),n=t(514041),o=t(908867),s=t(490343),i=t(60153),d=t(604343),l=t(254491),u=t(225555),c=t(701088),p=t(443791),f=t(831085);function ChangeLogMarkdown({changelog:e}){var[{locale:r}]=(0,d.useSettingsPersistAtom)(),[t,o]=(0,n.useState)(r);return(0,n.useEffect)((function(){(0,a.A)((function*(){"system"===r&&o(yield i.A.serviceSetting.getCurrentLocale())}))()}),[r]),(0,f.jsx)(s.Markdown,{children:e?.["zh-CN"===t?"zh-CN":"en-US"]||"No change log found."})}function ChangeLogSection({title:e,icon:r,isDone:t,updateInfo:a}){var i=(0,o.A)(),[d,u]=(0,n.useState)(t),c=(0,n.useCallback)((function(){u(!d)}),[d]);return(0,f.jsxs)(s.Stack,{children:[(0,f.jsxs)(s.XStack,{space:"$3",py:"$2",ai:"center",onPress:c,children:[(0,f.jsx)(s.Icon,{name:r,size:"$5"}),(0,f.jsxs)(s.Stack,{flex:1,children:[(0,f.jsx)(s.SizableText,{size:"$bodyLgMedium",children:e}),(0,f.jsx)(s.SizableText,{size:"$bodyMd",color:t?"$textSubdued":"$textInfo",children:t?i.formatMessage({id:l.ETranslations.update_updated_to_latest_version},{version:a?.toVersion||i.formatMessage({id:l.ETranslations.global_unknown})}):i.formatMessage({id:l.ETranslations.global_version_is_available},{version:a?.toVersion||i.formatMessage({id:l.ETranslations.global_unknown})})})]}),(0,f.jsx)(s.IconButton,{icon:d?"ChevronDownSmallOutline":"ChevronTopSmallOutline",variant:"tertiary",onPress:c})]}),d?null:(0,f.jsxs)(s.Stack,{bg:"$bgStrong",p:"$5",borderRadius:"$3",children:[(0,f.jsx)(p.Y,{fromVersion:a?.fromVersion,toVersion:a?.toVersion}),(0,f.jsx)(ChangeLogMarkdown,{changelog:a?.changelog})]})]})}function FirmwareChangeLogContentView({result:e,isDone:r}){var t=(0,o.A)();return(0,f.jsxs)(s.Stack,{mt:"$8",children:[e?.updateInfos?.bootloader?.hasUpgrade?(0,f.jsx)(ChangeLogSection,{title:t.formatMessage({id:l.ETranslations.global_bootloader}),icon:"StorageOutline",updateInfo:e?.updateInfos?.bootloader,isDone:r}):null,e?.updateInfos?.ble?.hasUpgrade?(0,f.jsx)(ChangeLogSection,{title:t.formatMessage({id:l.ETranslations.global_bluetooth}),icon:"BluetoothOutline",updateInfo:e?.updateInfos?.ble,isDone:r}):null,e?.updateInfos?.firmware?.hasUpgrade?(0,f.jsx)(ChangeLogSection,{title:t.formatMessage({id:l.ETranslations.global_firmware}),icon:"LaunchOutline",updateInfo:e?.updateInfos?.firmware,isDone:r}):null]})}function FirmwareChangeLogView({result:e}){var r=(0,o.A)(),[,t]=(0,d.useFirmwareUpdateStepInfoAtom)();return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(u.nv,{onConfirmText:r.formatMessage({id:l.ETranslations.update_update_now}),onConfirm:function(){return t({step:d.EFirmwareUpdateSteps.showCheckList,payload:void 0})}}),(0,f.jsxs)(s.Stack,{children:[(0,f.jsx)(c.N,{result:e}),(0,f.jsx)(FirmwareChangeLogContentView,{result:e})]})]})}},139499:(e,r,t)=>{t.d(r,{k:()=>FirmwareCheckingLoading});var a=t(908867),n=t(490343),o=t(254491),s=t(831085);function FirmwareCheckingLoading({connectId:e}){var r=(0,a.A)();return(0,s.jsxs)(n.Stack,{ai:"center",jc:"center",h:500,children:[(0,s.jsx)(n.Spinner,{size:"large"}),(0,s.jsx)(n.SizableText,{my:"$6",size:"$headingLg",children:r.formatMessage({id:o.ETranslations.update_checking_for_updates})}),null]})}},88569:(e,r,t)=>{t.d(r,{m:()=>FirmwareInstallingView,V:()=>FirmwareInstallingViewBase});var a=t(514041),n=t(490343),o=t(604343),s=t(908867),i=t(254491),d=t(613838),l=t(973066),u=t(723337),c=t(225555),p=t(831085);function FirmwareUpdateDone({result:e}){var r=(0,s.A)(),t=(0,d.B)();return(0,p.jsxs)(n.Stack,{children:[(0,p.jsx)(u.u,{icon:"CheckRadioSolid",tone:"success",title:r.formatMessage({id:i.ETranslations.update_all_updates_complete})}),(0,p.jsx)(l.i,{result:e,isDone:!0}),(0,p.jsx)(c.nv,{onConfirmText:r.formatMessage({id:i.ETranslations.global_got_it}),onConfirm:function(){t.closeUpdateModal()}})]})}var f=t(853748),g=t(99202),m=t(701088);function FirmwareInstallingViewBase({result:e,isDone:r,tipMessage:t,retryInfo:o,progressBarKey:s}){(0,p.jsx)(m.N,{result:e});var i=(0,a.useMemo)((function(){return r?(0,p.jsx)(FirmwareUpdateDone,{result:e}):o?(0,p.jsx)(f.uH.InstallingErrors,{retryInfo:o,result:e,lastFirmwareTipMessage:t}):(0,p.jsx)(g.D,{lastFirmwareTipMessage:t,isDone:r},s)}),[r,s,e,o,t]);return(0,p.jsx)(n.Stack,{children:i})}function FirmwareInstallingView({result:e,isDone:r}){var[t]=(0,o.useFirmwareUpdateStepInfoAtom)(),[n]=(0,o.useFirmwareUpdateRetryAtom)(),[s]=(0,o.useHardwareUiStateAtom)(),i=(0,a.useRef)(0);t.step===o.EFirmwareUpdateSteps.updateStart&&(i.current=t.payload.startAtTime);var d=s?.payload?.firmwareTipData?.message,[l,u]=(0,a.useState)();return(0,a.useEffect)((function(){d&&u(d)}),[d]),(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(FirmwareInstallingViewBase,{result:e,isDone:r,tipMessage:l,retryInfo:n,progressBarKey:i.current})})}},411252:(e,r,t)=>{t.d(r,{p:()=>FirmwareLatestVersionInstalled});var a=t(908867),n=t(490343),o=t(254491),s=t(831085);function FirmwareLatestVersionInstalled(){var e=(0,a.A)();return(0,s.jsxs)(n.Stack,{ai:"center",jc:"center",h:500,children:[(0,s.jsx)(n.Icon,{size:"$14",name:"CheckRadioSolid",color:"$iconSuccess"}),(0,s.jsx)(n.SizableText,{my:"$6",size:"$headingLg",children:e.formatMessage({id:o.ETranslations.update_latest_version})})]})}},723337:(e,r,t)=>{t.d(r,{u:()=>FirmwareUpdateBaseMessageView});var a=t(514041),n=t(908867),o=t(490343),s=t(726130),i=t(254491),d=(t(663522),t(831085)),getColors=function(e){switch(e){case"destructive":return{iconWrapperBg:"$bgCritical",iconColor:"$iconCritical"};case"warning":return{iconWrapperBg:"$bgCaution",iconColor:"$iconCaution"};case"success":return{iconWrapperBg:"$bgSuccess",iconColor:"$iconSuccess"};default:return{iconWrapperBg:"$bgStrong",iconColor:"$icon"}}};function UpdateErrorTroubleshooting(){var e=(0,n.A)().formatMessage({id:i.ETranslations.update_troubleshoot_connection_issues,defaultMessage:"If you have any questions, please refer to the troubleshooting guide."}).split("\n");return(0,d.jsx)(o.Stack,{children:e.map((function(e,r){return e.includes("<url>")?(0,d.jsx)(o.RichSizeableText,{size:"$bodyMd",color:"$textSubdued",linkList:{url:{url:s.ks}},children:e},r):(0,d.jsx)(o.SizableText,{size:"$bodyMd",color:"$textSubdued",children:e},r)}))})}function FirmwareUpdateBaseMessageView({icon:e,title:r,tone:t,message:n,linkList:s,displayTroubleshooting:i}){var l=(0,a.useCallback)((function(){return e?.endsWith("Solid")?(0,d.jsx)(o.Icon,{name:e,size:"$14",color:getColors(t).iconColor}):(0,d.jsx)(o.Stack,{alignSelf:"flex-start",p:"$3",borderRadius:"$full",bg:getColors(t).iconWrapperBg,children:(0,d.jsx)(o.Icon,{name:e,size:"$7",color:getColors(t).iconColor})})}),[e,t]);return(0,d.jsxs)(o.Stack,{py:"$6",gap:"$5",children:[(0,d.jsxs)(o.Stack,{children:[e?l():null,r?(0,d.jsx)(o.SizableText,{my:"$4",size:"$heading2xl",children:r}):null,n?(0,d.jsx)(o.RichSizeableText,{size:"$bodyLg",color:"$textSubdued",linkList:s,children:n}):null]}),i?(0,d.jsx)(UpdateErrorTroubleshooting,{}):null]})}},711426:(e,r,t)=>{t.d(r,{J:()=>FirmwareUpdateCheckList});var a=t(586330),n=t(514041),o=t(908867),s=t(490343),i=t(604343),d=t(16853),l=t(254491),u=(t(663522),t(60153)),c=t(225555),p=t(831085);function FirmwareUpdateCheckList({result:e}){var r=(0,o.A)(),[,t]=(0,i.useFirmwareUpdateStepInfoAtom)(),[,f]=(0,i.useFirmwareUpdateWorkflowRunningAtom)(),[g,m]=(0,n.useState)([{label:r.formatMessage({id:l.ETranslations.update_i_have_backed_up_my_recovery_phrase}),emoji:"âœ…",value:!1},{label:r.formatMessage({id:l.ETranslations.update_device_connected_via_usb}),emoji:"ðŸ“²",value:!1},{label:r.formatMessage({id:l.ETranslations.update_device_fully_charged}),emoji:"ðŸ”‹",value:!1},{label:r.formatMessage({id:l.ETranslations.update_only_one_device_connected}),emoji:"ðŸ“±",value:!1},{label:r.formatMessage({id:l.ETranslations.update_all_other_apps_closed}),emoji:"ðŸ†—",value:!1}]),_=(0,n.useCallback)((function(e){e.value=!e.value,m([...g])}),[g]),w=(0,n.useMemo)((function(){return g.every((function(e){return e.value}))}),[g]);return(0,p.jsxs)(s.Stack,{children:[(0,p.jsx)(s.SizableText,{size:"$heading2xl",my:"$8",children:r.formatMessage({id:l.ETranslations.update_ready_to_upgrade_checklist})}),(0,p.jsx)(s.Stack,{space:"$3",mr:"$3",children:g.map((function(e){return(0,p.jsx)(s.Checkbox,{value:e.value,label:e.value?`${e.label} ${e.emoji}`:e.label,onChange:function(){return _(e)}},e.label)}))}),(0,p.jsx)(c.nv,{confirmButtonProps:{disabled:!w},onConfirm:e?(0,a.A)((function*(){if(e)try{t({step:i.EFirmwareUpdateSteps.updateStart,payload:{startAtTime:Date.now()}}),f(!0),yield u.A.serviceFirmwareUpdate.startUpdateWorkflow({backuped:!0,usbConnected:!0,releaseResult:e}),t({step:i.EFirmwareUpdateSteps.updateDone,payload:void 0})}catch(e){t({step:i.EFirmwareUpdateSteps.error,payload:{error:(0,d.xm)(e)}})}finally{f(!1)}})):void 0,onConfirmText:r.formatMessage({id:l.ETranslations.global_continue})})]})}},853748:(e,r,t)=>{t.d(r,{_V:()=>EnterBootModeGuide,uH:()=>h,RH:()=>useFirmwareUpdateErrors});var a=t(586330),n=t(514041),o=t(813362),s=t(908867),i=t(490343),d=t(604343),l=t(726130),u=t(319357),c=t(514527),p=t(254491),f=t(117746),g=t(100645),m=t(60153);const _=t.p+"static/media/enter-boot-guide-mini.e82812de54d81a27fd02.png";var w=t(723337),x=t(225555),v=t(831085);function CommonError({message:e,title:r,icon:t,displayTroubleshooting:a}){var n=(0,s.A)();return(0,v.jsx)(w.u,{icon:t,tone:"destructive",title:r||n.formatMessage({id:p.ETranslations.global_an_error_occurred}),message:e,displayTroubleshooting:a})}function ShouldUpdateBridge({result:e}){var r=(0,s.A)();return(0,v.jsxs)(i.Stack,{children:[(0,v.jsx)(w.u,{icon:"InfoCircleOutline",title:r.formatMessage({id:p.ETranslations.update_outdated_version_detected}),message:r.formatMessage({id:p.ETranslations.update_hardware_update_requires_bridge}),linkList:{url:{url:l.F3}}}),(0,v.jsx)(x.nv,{onConfirm:function(){(0,f.Dr)(l.F3)},onConfirmText:r.formatMessage({id:p.ETranslations.global_view_tutorial})})]})}function ShouldUpdateByWeb(){var e=(0,s.A)();return(0,v.jsxs)(i.Stack,{children:[(0,v.jsx)(w.u,{icon:"InfoCircleOutline",title:e.formatMessage({id:p.ETranslations.update_update_in_official_web_tool}),message:e.formatMessage({id:p.ETranslations.update_update_in_official_web_tool_desc}),linkList:{url:{url:l.BZ}}}),(0,v.jsx)(x.nv,{onConfirm:function(){(0,f.Dr)(l.BZ)},onConfirmText:e.formatMessage({id:p.ETranslations.global_visit_website})})]})}function HowToUpdateFullResource(){var e=(0,s.A)();return(0,v.jsxs)(i.Stack,{children:[(0,v.jsx)(w.u,{icon:"InfoCircleOutline",title:e.formatMessage({id:p.ETranslations.update_outdated_version_detected}),message:e.formatMessage({id:p.ETranslations.update_outdated_version_detected_desc}),linkList:{url:{url:l.Kj}}}),(0,v.jsx)(x.nv,{onConfirm:function(){(0,f.Dr)(l.Kj)},onConfirmText:e.formatMessage({id:p.ETranslations.global_view_tutorial})})]})}function EnterBootModeGuide({deviceType:e}){var r=(0,s.A)();return"mini"===e?(0,v.jsxs)(i.Stack,{mb:"$6",children:[(0,v.jsx)(i.Image,{w:353,h:224,source:_}),(0,v.jsx)(i.SizableText,{size:"$headingMd",children:r.formatMessage({id:p.ETranslations.update_manually_entering_bootloader_mode})}),(0,v.jsx)(i.SizableText,{mt:"$2",color:"$textSubdued",children:r.formatMessage({id:p.ETranslations.update_manually_entering_bootloader_mode_desc})})]}):(0,v.jsx)(i.Stack,{mb:"$6",children:(0,v.jsx)(i.RichSizeableText,{mt:"$2",linkList:{url:{url:l.zz}},children:p.ETranslations.update_follow_online_tutorial_to_proceed_manually})})}function useFirmwareUpdateErrors({error:e,onRetry:r,result:t,lastFirmwareTipMessage:a}){var i=(0,s.A)(),d=i.formatMessage({id:p.ETranslations.global_retry});return(0,n.useMemo)((function(){if((0,c.R4)({error:e,code:[o.HardwareErrorCode.PinCancelled,o.HardwareErrorCode.ActionCancelled,o.HardwareErrorCode.DeviceInterruptedFromOutside]}))return{content:(0,v.jsx)(CommonError,{icon:"CrossedLargeOutline",title:i.formatMessage({id:p.ETranslations.update_operation_canceled}),message:i.formatMessage({id:p.ETranslations.update_operation_canceled_desc})}),onRetryHandler:r,retryText:d};if((0,c.R4)({error:e,code:o.HardwareErrorCode.FirmwareUpdateDownloadFailed}))return{content:(0,v.jsx)(CommonError,{icon:"DownloadOutline",title:i.formatMessage({id:p.ETranslations.update_download_failed}),message:i.formatMessage({id:p.ETranslations.update_check_connection_try_again})}),onRetryHandler:r,retryText:d};if((0,c.R4)({error:e,code:o.HardwareErrorCode.PinInvalid}))return{content:(0,v.jsx)(CommonError,{icon:"CrossedLargeOutline",message:i.formatMessage({id:p.ETranslations.hardware_invalid_pin_error})}),onRetryHandler:r,retryText:d};if((0,c.R4)({error:e,code:o.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot})||(0,c.R4)({error:e,code:o.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure})||e&&a===g.rn.AutoRebootToBootloader)return{content:(0,v.jsx)(CommonError,{icon:"CrossedLargeOutline",title:i.formatMessage({id:p.ETranslations.update_manually_entering_bootloader_mode})}),detail:(0,v.jsx)(EnterBootModeGuide,{deviceType:t?.deviceType}),onRetryHandler:r,retryText:"mini"===t?.deviceType?i.formatMessage({id:p.ETranslations.update_verify_status_and_continue}):d};if((0,c.R4)({error:e,code:[o.HardwareErrorCode.BridgeNetworkError]}))return{content:(0,v.jsx)(CommonError,{icon:"CrossedLargeOutline",title:i.formatMessage({id:p.ETranslations.update_bridge_network_error}),message:i.formatMessage({id:p.ETranslations.update_unable_to_connect_to_bridge})}),onRetryHandler:r,retryText:d};if((0,c.R4)({error:e,code:[o.HardwareErrorCode.BridgeTimeoutError]}))return{content:(0,v.jsx)(CommonError,{icon:"CrossedLargeOutline",title:i.formatMessage({id:p.ETranslations.update_bridge_timeout_error}),message:i.formatMessage({id:p.ETranslations.update_connection_to_bridge_timed_out})}),onRetryHandler:r,retryText:d};if((0,c.R4)({error:e,code:[o.HardwareErrorCode.BridgeNotInstalled,u.o.NeedOneKeyBridge]}))return{content:(0,v.jsx)(w.u,{icon:"CrossedLargeOutline",tone:"destructive",title:i.formatMessage({id:p.ETranslations.update_bridge_not_installed}),message:i.formatMessage({id:p.ETranslations.update_hardware_update_requires_bridge}),linkList:{url:{url:l.F3}}}),onRetryHandler:r,retryText:d};if((0,c.R4)({error:e,code:u.o.NeedOneKeyBridgeUpgrade}))return{content:(0,v.jsx)(ShouldUpdateBridge,{result:t}),retryText:d};if((0,c.R4)({error:e,code:u.o.NeedFirmwareUpgradeFromWeb}))return{content:(0,v.jsx)(ShouldUpdateByWeb,{}),retryText:d};if((0,c.R4)({error:e,code:o.HardwareErrorCode.UseDesktopToUpdateFirmware}))return{content:(0,v.jsx)(HowToUpdateFullResource,{}),retryText:d};if(e){var n=e?.message;return 4500===e.code&&(n=i.formatMessage({id:p.ETranslations.feedback_hw_polling_time_out})),{content:(0,v.jsx)(CommonError,{icon:"CrossedLargeOutline",message:n,displayTroubleshooting:!0}),onRetryHandler:r,retryText:d}}return{content:null,retryText:d}}),[i,e,a,d,r,t])}var h={ShouldUpdateBridge,CommonError,EnterBootModeGuide,WorkflowErrors:function WorkflowErrors({onRetry:e,error:r,result:t}){var a=(0,s.A)(),{onRetryHandler:n,content:o,retryText:i}=useFirmwareUpdateErrors({error:r,onRetry:e,result:t,lastFirmwareTipMessage:void 0});return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(x.nv,{onConfirm:n,onConfirmText:i||a.formatMessage({id:p.ETranslations.global_retry})}),o]})},InstallingErrors:function InstallingErrors({retryInfo:e,result:r,lastFirmwareTipMessage:t}){var o=(0,s.A)(),[,i]=(0,d.useFirmwareUpdateStepInfoAtom)(),l=(0,n.useCallback)((0,a.A)((function*(){if(!e)return null;i({step:d.EFirmwareUpdateSteps.updateStart,payload:{startAtTime:Date.now()}}),yield m.A.serviceFirmwareUpdate.retryUpdateTask({id:e?.id,connectId:r?.updatingConnectId,releaseResult:r})})),[r,e,i]),{content:u,detail:c,onRetryHandler:f,retryText:g}=useFirmwareUpdateErrors({onRetry:l,result:r,lastFirmwareTipMessage:t,error:e?.error});return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(x.nv,{onConfirm:f,onConfirmText:g||o.formatMessage({id:p.ETranslations.global_retry})}),u,c]})}}},225555:(e,r,t)=>{t.d(r,{nv:()=>d,oh:()=>FirmwareUpdatePageLayout});var a=t(908867),n=t(490343),o=t(254491),s=t(498356),i=t(831085);function FirmwareUpdatePageHeader(){var e=(0,a.A)();return(0,i.jsx)(n.Page.Header,{dismissOnOverlayPress:!1,title:e.formatMessage({id:o.ETranslations.update_hardware_update})})}var d=n.Page.Footer;function FirmwareUpdatePageLayout({children:e}){(0,s.A)();return(0,i.jsxs)(n.Stack,{children:[(0,i.jsx)(FirmwareUpdatePageHeader,{}),(0,i.jsx)(n.Page.Body,{children:(0,i.jsx)(n.Stack,{p:"$5",children:e})})]})}},99202:(e,r,t)=>{t.d(r,{D:()=>FirmwareUpdateProgressBar,w:()=>FirmwareUpdateProgressBarView});var a=t(460986),n=t.n(a),o=t(514041),s=t(908867),i=t(490343),d=t(604343),l=t(254491),u=t(284908),c=t(100645),p=t(60153),f=t(394764),g=t(443791),m=t(831085),_=10;function FirmwareUpdateProgressBarView({totalStep:e,currentStep:r,title:t,fromVersion:a,toVersion:n,progress:d,desc:u}){var c=(0,s.A)(),p=(0,o.useMemo)((function(){return e&&r?e<=1?null:(0,m.jsx)(i.SizableText,{size:"$bodyMd",color:"$textSubdued",children:c.formatMessage({id:l.ETranslations.global_step_str},{step:`${r}/${e}`})}):(0,m.jsx)(i.Skeleton,{width:120,height:16})}),[c,r,e]),f=(0,o.useMemo)((function(){return n?(0,m.jsx)(g.Y,{fromVersion:a,toVersion:n}):(0,m.jsx)(i.Skeleton,{width:80,height:16})}),[a,n]);return(0,m.jsxs)(i.Stack,{py:"$6",children:[p,(0,m.jsx)(i.SizableText,{size:"$heading2xl",my:"$3",children:t}),f,(0,m.jsx)(i.Stack,{mt:"$12",mb:"$3",children:(0,m.jsx)(i.Progress,{size:"medium",value:d})}),(0,m.jsx)(i.SizableText,{size:"$bodyLg",color:"$textSubdued",children:u})]})}function FirmwareUpdateProgressBar({lastFirmwareTipMessage:e,isDone:r}){var t=(0,s.A)(),[a]=(0,d.useFirmwareUpdateStepInfoAtom)(),[g]=(0,d.useHardwareUiStateAtom)(),[w]=(0,d.useHardwareUiStateCompletedAtom)(),[x,v]=(0,o.useState)(1),[h]=(0,d.useFirmwareUpdateRetryAtom)(),E=(0,o.useRef)(x);E.current=x;var T=(0,o.useRef)(_),y=(0,o.useCallback)((function(){return t.formatMessage({id:l.ETranslations.global_checking_device})}),[t]),[b,S]=(0,o.useState)(y()),j=(0,o.useMemo)((function(){if(a?.step===d.EFirmwareUpdateSteps.installing)return a.payload.installingTarget?.updateInfo?.firmwareType||void 0}),[a.payload,a?.step]),{totalStep:M,currentStep:F}=(0,o.useMemo)((function(){if(a?.step===d.EFirmwareUpdateSteps.installing){var e=a?.payload?.installingTarget;if(e)return{totalStep:e.totalPhase.length,currentStep:e.totalPhase.findIndex((function(r){return r===e.currentPhase}))+1}}return{totalPhase:null,currentPhase:null}}),[a.payload,a?.step]),k=(0,o.useMemo)((function(){if(a?.step===d.EFirmwareUpdateSteps.installing)return{fromVersion:a.payload.installingTarget?.updateInfo.fromVersion||void 0,toVersion:a.payload.installingTarget?.updateInfo.toVersion||void 0}}),[a.payload,a?.step]),A=g?.payload?.firmwareTipData?.message,C=g?.payload?.firmwareProgress,U=u.A.isConfirmOnDeviceAction(g),L=([c.rn.CheckLatestUiResource,c.rn.DownloadLatestUiResource,c.rn.DownloadLatestUiResourceSuccess,c.rn.UpdateSysResource,c.rn.UpdateSysResourceSuccess].includes(e),(0,f.Z)(j)),R=(0,o.useRef)(C);R.current=C;var $=(0,o.useRef)([]),I=(0,o.useMemo)((function(){var a=t.formatMessage({id:l.ETranslations.global_preparing});return e&&(a=t.formatMessage({id:l.ETranslations.global_updating})),j&&(a=t.formatMessage({id:l.ETranslations.global_updating_type},{type:j}),"ble"===j&&(a=t.formatMessage({id:l.ETranslations.global_updating_type},{type:t.formatMessage({id:l.ETranslations.global_bluetooth})}))),r&&(a=t.formatMessage({id:l.ETranslations.global_done})),a}),[t,j,r,e]),B=(0,o.useCallback)((function(e){var r=[{type:["checking"],progress:function(){return 1},progressMax:function(){return _},desc:function(){return t.formatMessage({id:l.ETranslations.update_checking_device_if_no_restart})}},{type:[c.rn.CheckLatestUiResource],progress:function(){return 2},desc:function(){return t.formatMessage({id:l.ETranslations.update_checking_latest_ui_resources})}},{type:[c.rn.DownloadLatestUiResource],progress:function(){return 3},desc:function(){return t.formatMessage({id:l.ETranslations.update_downloading_latest_ui_resources})}},{type:[c.rn.DownloadLatestUiResourceSuccess],progress:function(){return 5},desc:function(){return t.formatMessage({id:l.ETranslations.update_download_success})}},{type:[c.rn.UpdateSysResource],progress:function(){return 7},desc:function(){return t.formatMessage({id:l.ETranslations.update_updating_ui_resources})}},{type:[c.rn.UpdateSysResourceSuccess],progress:function(){return 9},desc:function(){return t.formatMessage({id:l.ETranslations.update_update_ui_resources_success})}},{type:[c.rn.AutoRebootToBootloader],progress:function(){return 10},desc:function(){return t.formatMessage({id:l.ETranslations.update_reboot_to_bootloader_mode})}},{type:[c.rn.GoToBootloaderSuccess],progress:function(){return 12},desc:function(){return t.formatMessage({id:l.ETranslations.update_reboot_success})}},{type:[c.rn.DownloadFirmware,c.rn.DownloadLatestBootloaderResource],progress:function(){return 14},desc:function(){return t.formatMessage({id:l.ETranslations.update_downloading})}},{type:[c.rn.DownloadFirmwareSuccess,c.rn.DownloadLatestBootloaderResourceSuccess],progress:function(){return 20},desc:function(){return t.formatMessage({id:l.ETranslations.update_download_success})}},{type:[c.rn.FirmwareEraseSuccess],progress:function(){return 25},desc:function(){return t.formatMessage({id:l.ETranslations.update_transferring_data})}},{type:["installing"],progress:function(){var e,r=30+.7*(null!=(e=R.current)?e:0);return r>=99&&(r=99),r},desc:function(){return 100===R.current?t.formatMessage({id:l.ETranslations.update_installing}):t.formatMessage({id:l.ETranslations.update_transferring_data})}},{type:["done"],progress:function(){return 100},desc:function(){return t.formatMessage({id:l.ETranslations.update_update_completed})}}],a=r.findIndex((function(r){return r.type.includes(e)}));if(a>=0){var n,o=r[a],s=o.progress(),i=E.current;v((function(){var e=Math.max(s,i);return E.current=e,e})),S(o.desc());var d=r[a+1],u=null!=(n=o?.progressMax?.())?n:d?.progress();T.current=u||99}}),[t]),D=(0,o.useRef)(B);D.current=B,(0,o.useEffect)((function(){h||j&&L&&j!==L&&(v(1),E.current=1,T.current=99,D.current("checking"))}),[j,L,h]),(0,o.useEffect)((function(){a?.step!==d.EFirmwareUpdateSteps.updateStart&&j||S(y())}),[y,j,a?.step]),(0,o.useEffect)((function(){var e=setInterval((function(){if(!h&&!r&&!U){var e=E.current;v((function(){if(e>=T.current)return T.current;if(e>=99)return 99;var r=Math.min(e+1,T.current,99);return E.current=r,r}))}}),2e3);return function(){clearInterval(e)}}),[j,U,r,h]),(0,o.useEffect)((function(){r&&setTimeout((function(){D.current("done")}),1e3)}),[r]),(0,o.useEffect)((function(){A&&$.current.push(A)}),[A]),(0,o.useEffect)((function(){n()(C)&&D.current("installing")}),[C]),(0,o.useEffect)((function(){w?.action===d.EHardwareUiStateAction.CLOSE_UI_WINDOW&&p.A.serviceHardwareUI.closeHardwareUiStateDialog({skipDeviceCancel:!0,connectId:void 0})}),[w?.action]),(0,o.useEffect)((function(){e&&D.current(e)}),[e]);var[z,P]=(0,o.useState)(!1),V=(0,o.useMemo)((function(){0}),[C,e,x,z]);return(0,m.jsxs)(i.Stack,{children:[(0,m.jsx)(FirmwareUpdateProgressBarView,{totalStep:M,currentStep:F,title:I,progress:x,desc:b,fromVersion:k?.fromVersion,toVersion:k?.toVersion}),V]})}},701088:(e,r,t)=>{t.d(r,{N:()=>FirmwareUpdateWalletProfile});var a=t(908867),n=t(490343),o=t(254491),s=t(508343),i=t(831085);function FirmwareUpdateWalletProfile({result:e}){var r=(0,a.A)();return(0,i.jsxs)(n.Stack,{onPress:function(){},children:[(0,i.jsx)(s.G,{size:"$14",deviceType:e?.deviceType||"unknown"}),(0,i.jsxs)(n.SizableText,{mt:"$5",size:"$heading2xl",children:[r.formatMessage({id:o.ETranslations.update_new_hardware_updates})," "]})]})}},296437:(e,r,t)=>{t.d(r,{Y:()=>FirmwareUpdateWarningMessage});var a=t(908867),n=t(490343),o=t(254491),s=(t(663522),t(831085));function FirmwareUpdateWarningMessage(){var e=(0,a.A)();return(0,s.jsx)(n.Alert,{type:"warning",title:e.formatMessage({id:o.ETranslations.update_keep_usb_connected_and_app_active}),fullBleed:!0,mx:"$-5"})}},443791:(e,r,t)=>{t.d(r,{Y:()=>FirmwareVersionProgressBar});var a=t(514041),n=t(908867),o=t(302722),s=t.n(o),i=t(490343),d=t(254491),l=t(831085);function FirmwareVersionProgressBar({fromVersion:e="",toVersion:r=""}){var t=(0,n.A)().formatMessage({id:d.ETranslations.global_unknown}),o=(0,a.useCallback)((function(e){return!!e&&(!!s().valid(e)&&!s().eq(e,"0.0.0"))}),[]);return(0,l.jsxs)(i.XStack,{space:"$2.5",alignItems:"center",children:[(0,l.jsx)(i.Badge,{badgeType:"default",badgeSize:"lg",children:o(e)?e:t}),(0,l.jsx)(i.Icon,{name:"ArrowRightSolid",size:"$4"}),(0,l.jsx)(i.Badge,{badgeType:"info",badgeSize:"lg",children:r?.length>0?r:t})]})}},697840:(e,r,t)=>{t.r(r),t.d(r,{default:()=>k});var a=t(586330),n=t(514041),o=t(490343),s=t(604343),i=t(16853),d=t(60153),l=t(498356),u=t(326745),c=t(911998),p=t(973066),f=t(139499),g=t(88569),m=t(411252),_=t(711426),w=t(853748),x=t(334025),v=t(908867),h=t(254491),E=t(355931),T=t(493360),y=t(663522),b=t(613838),S=!1;function ForceExtensionUpdatingFromExpandTab(){return function useExtensionUpdatingFromExpandTab(){var e=(0,u.u)(),r=(0,b.B)();(0,n.useEffect)((function(){y.Ay.isExtensionUiPopup&&(r.openChangeLogOfExtension(e.params),window.close())}),[r,e.params])}(),null}function FirmwareUpdateExitPrevent(){var e=(0,v.A)(),r=e.formatMessage({id:h.ETranslations.update_quit_update}),t=e.formatMessage({id:h.ETranslations.update_quit_update_desc});return(0,x.Wg)(),function useModalExitPrevent({title:e,message:r}){var t=(0,v.A)(),a=(0,l.A)(),s=(0,n.useCallback)((function({data:n}){S||(S=!0,o.Dialog.show({title:e,description:r,onConfirmText:t.formatMessage({id:h.ETranslations.global_quit}),onConfirm:function(){a.dispatch(n.action)},onCancelText:t.formatMessage({id:h.ETranslations.global_cancel}),onClose:function(){S=!1}}))}),[r,a,e,t]);(0,o.usePreventRemove)(!0,s)}({title:r,message:t}),function useAppExitPrevent({message:e,title:r}){var t=(0,v.A)();(0,n.useEffect)((function(){if(y.Ay.isRuntimeBrowser&&!y.Ay.isExtensionUiPopup){var fn=function(r){return r.preventDefault(),r.returnValue=!0,e};return window.addEventListener("beforeunload",fn),function(){window.removeEventListener("beforeunload",fn)}}}),[e]),(0,n.useEffect)((function(){var a=T.A.addEventListener("hardwareBackPress",(function(){return E.A.alert(r,e,[{text:t.formatMessage({id:h.ETranslations.global_cancel}),onPress:function(){},style:"cancel"},{text:t.formatMessage({id:h.ETranslations.global_quit}),onPress:function(){return T.A.exitApp()}}],{cancelable:!1}),!0}));return function(){return a.remove()}}),[e,r,t])}({title:r,message:t}),null}var j=t(225555),M=t(296437),F=t(831085);const k=function PageFirmwareUpdateChangeLog(){var e=(0,u.u)(),r=e?.params?.connectId,[t,x]=((0,l.A)(),(0,s.useFirmwareUpdateStepInfoAtom)()),{result:v,run:h,isLoading:E}=(0,c.yk)((0,a.A)((function*(){try{var e=yield d.A.serviceFirmwareUpdate.checkAllFirmwareRelease({connectId:r});return e?.hasUpgrade&&x({step:s.EFirmwareUpdateSteps.showChangeLog,payload:void 0}),e}catch(e){x({step:s.EFirmwareUpdateSteps.error,payload:{error:(0,i.xm)(e)}})}})),[r,x],{watchLoading:!0}),T=(0,n.useMemo)((function(){if(E)return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(FirmwareUpdateExitPrevent,{}),(0,F.jsx)(f.k,{connectId:r})]});if(t.step===s.EFirmwareUpdateSteps.error)return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(M.Y,{}),(0,F.jsx)(FirmwareUpdateExitPrevent,{}),(0,F.jsx)(w.uH.WorkflowErrors,{error:t.payload.error,onRetry:h,result:v})]});if(t.step===s.EFirmwareUpdateSteps.showChangeLog)return(0,F.jsx)(p.z,{result:v});if(t.step===s.EFirmwareUpdateSteps.showCheckList)return(0,F.jsx)(_.J,{result:v});if(t.step===s.EFirmwareUpdateSteps.updateStart||t.step===s.EFirmwareUpdateSteps.installing||t.step===s.EFirmwareUpdateSteps.updateDone){var e=t.step===s.EFirmwareUpdateSteps.updateDone;return(0,F.jsxs)(F.Fragment,{children:[e?null:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(M.Y,{}),(0,F.jsx)(FirmwareUpdateExitPrevent,{})]}),(0,F.jsx)(g.m,{result:v,isDone:e})]})}return(0,F.jsx)(F.Fragment,{children:(0,F.jsx)(m.p,{})})}),[r,E,v,h,t.payload,t.step]);return(0,F.jsx)(o.Page,{scrollEnabled:!0,onUnmounted:(0,a.A)((function*(){yield d.A.serviceFirmwareUpdate.exitUpdateWorkflow()})),children:(0,F.jsxs)(j.oh,{children:[(0,F.jsx)(ForceExtensionUpdatingFromExpandTab,{}),T]})})}},334025:(e,r,t)=>{t.d(r,{Wg:()=>useKeepAwake});var a,n=t(586330),o=t(72631),s=t(514041),i=t(683180),d=t(34546);!function(e){e.RELEASE="release"}(a||(a={}));var l={};const u={isAvailableAsync:()=>(0,n.A)((function*(){return!!i.A.isDOMAvailable&&"wakeLock"in navigator}))(),activate:e=>(0,n.A)((function*(){if(i.A.isDOMAvailable){var r=yield navigator.wakeLock.request("screen");l[e]=r}}))(),deactivate:e=>(0,n.A)((function*(){if(i.A.isDOMAvailable){if(!l[e])throw new d.A("ERR_KEEP_AWAKE_TAG_INVALID",`The wake lock with tag ${e} has not activated yet`);l[e].release?.(),delete l[e]}}))(),addListenerForTag(e,r){var eventListener=function(){r({state:a.RELEASE})},t=l[e];return t&&("addEventListener"in t?t.addEventListener?.("release",eventListener):t.onrelease=eventListener),{remove:function(){var r=l[e];r&&(r.removeEventListener?r.removeEventListener("release",eventListener):r.onrelease=null)}}}};var c="ExpoKeepAwakeDefaultTag";function useKeepAwake(e=c,r){(0,s.useEffect)((function(){var t=!0;return activateKeepAwakeAsync(e).then((function(){t&&u.addListenerForTag&&r?.listener&&function addListener(e,r){if(!u.addListenerForTag)throw new o.V("ExpoKeepAwake","addListenerForTag");var t="string"==typeof e?e:c,a="function"==typeof e?e:r;return u.addListenerForTag(t,a)}(e,r.listener)})),function(){t=!1,r?.suppressDeactivateWarnings?deactivateKeepAwake(e).catch((function(){})):deactivateKeepAwake(e)}}),[e])}function activateKeepAwakeAsync(){return _activateKeepAwakeAsync.apply(this,arguments)}function _activateKeepAwakeAsync(){return(_activateKeepAwakeAsync=(0,n.A)((function*(e=c){yield u.activate?.(e)}))).apply(this,arguments)}function deactivateKeepAwake(){return _deactivateKeepAwake.apply(this,arguments)}function _deactivateKeepAwake(){return(_deactivateKeepAwake=(0,n.A)((function*(e=c){yield u.deactivate?.(e)}))).apply(this,arguments)}}}]);
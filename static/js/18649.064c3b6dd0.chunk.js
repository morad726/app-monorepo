"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[18649],{536612:(e,t,a)=>{a.d(t,{SX:()=>useAppUpdateInfo,sx:()=>useDownloadPackage,x7:()=>useAppChangeLog});var n=a(324586),r=a(586330),s=a(514041),o=a(908867),i=a(490343),l=a(604343),c=a(713132),u=a(254491),p=a(639451),d=a(757559),f=a(584186),h=a(60153),y=a(498356),g=a(911998);function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach((function(t){(0,n.A)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var useAppChangeLog=function(e){var t=(0,g.yk)((function(){return e?h.A.serviceAppUpdate.fetchChangeLog():Promise.resolve(null)}),[e]);return(0,s.useMemo)((function(){return t.result}),[t.result])},useDownloadPackage=function(){var e,t=(0,o.A)();return(0,s.useCallback)((e=(0,r.A)((function*(e){try{yield h.A.serviceAppUpdate.startDownloading();var a=yield(0,p.Xo)(e);yield h.A.serviceAppUpdate.verifyPackage(a),yield Promise.all([(0,p.sB)(a),f.A.wait(3e3)]),yield h.A.serviceAppUpdate.readyToInstall()}catch(e){i.Toast.error({title:t.formatMessage({id:u.ETranslations.global_update_failed})}),h.A.serviceAppUpdate.notifyFailed(e)}})),function(t){return e.apply(this,arguments)}),[t])},useAppUpdateInfo=function(e=!1){var t=(0,o.A)(),[a]=(0,l.useAppUpdatePersistAtom)(),n=(0,y.A)(),r=useDownloadPackage(),f=(0,s.useCallback)((function(){setTimeout((function(){(e?n.pushFullModal:n.pushModal)(d.ry.AppUpdateModal,{screen:d.mk.WhatsNew})}))}),[e,n.pushFullModal,n.pushModal]),g=(0,s.useCallback)((function(e=!1,t){(e?n.pushFullModal:n.pushModal)(d.ry.AppUpdateModal,{screen:d.mk.UpdatePreview,params:_objectSpread({latestVersion:a.latestVersion,isForceUpdate:a.isForceUpdate,autoClose:e},t)})}),[a.isForceUpdate,a.latestVersion,n.pushFullModal,n.pushModal]);(0,s.useEffect)((function(){(0,c.fK)(a)&&f(),a.status===c.ue.downloading&&r(a),h.A.serviceAppUpdate.fetchAppUpdateInfo().then((function(e){e?.isForceUpdate&&(0,c._q)(e.latestVersion,e.status)&&g(!0,e)}))}),[]);var A=(0,s.useCallback)((function(){switch(a.status){case c.ue.notify:case c.ue.downloading:case c.ue.verifying:g(e);break;case c.ue.ready:(0,p.Ed)(a).catch((function(e){i.Toast.error({title:t.formatMessage({id:u.ETranslations.global_update_failed})}),h.A.serviceAppUpdate.notifyFailed(e)}));break;case c.ue.failed:r(a)}}),[a,r,t,e,g]);return(0,s.useMemo)((function(){return{isNeedUpdate:(0,c._q)(a.latestVersion,a.status),data:a,onUpdateAction:A,toUpdatePreviewPage:g,onViewReleaseInfo:f}}),[a,A,f,g])}},331250:(e,t,a)=>{a.d(t,{l:()=>ViewUpdateHistory});var n=a(514041),r=a(908867),s=a(490343),o=a(254491),i=a(117746),l=a(831085);function ViewUpdateHistory(){var e=(0,r.A)(),t=(0,n.useCallback)((function(){(0,i.Dr)("https://github.com/OneKeyHQ/app-monorepo/releases")}),[]);return(0,l.jsx)(s.XStack,{children:(0,l.jsx)(s.Button,{mt:"$5",iconAfter:"ArrowTopRightOutline",onPress:t,size:"small",children:e.formatMessage({id:o.ETranslations.update_update_history})})})}},418649:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var n=a(908867),r=a(490343),s=a(254491),o=a(663522),i=a(536612),l=a(331250),c=a(831085);const u=function WhatsNew(){var e=(0,n.A)(),{version:t=""}=o.Ay,a=(0,i.x7)(t);return(0,c.jsxs)(r.Page,{children:[(0,c.jsx)(r.Page.Header,{title:e.formatMessage({id:s.ETranslations.settings_whats_new})}),(0,c.jsxs)(r.Page.Body,{m:"$5",children:[(0,c.jsx)(r.YStack,{space:"$3",children:(0,c.jsx)(c.Fragment,{children:e.formatMessage({id:s.ETranslations.update_whats_new_in_onekey_version},{version:t}).split("\n").map((function(e){return(0,c.jsx)(r.Heading,{size:"$heading2xl",children:e},e)}))})}),a?(0,c.jsxs)(r.ScrollView,{mt:"$7",contentInsetAdjustmentBehavior:"automatic",contentContainerStyle:{pb:"$5"},children:[(0,c.jsx)(r.Markdown,{children:a}),(0,c.jsx)(l.l,{})]}):null]}),(0,c.jsx)(r.Page.Footer,{onCancelText:e.formatMessage({id:s.ETranslations.global_got_it}),onCancel:function(e){e()}})]})}},639451:(e,t,a)=>{a.d(t,{Ed:()=>c,Xo:()=>i,sB:()=>l,xf:()=>useDownloadProgress});var n,r,s,o=a(586330),i=(n=(0,o.A)((function*(){return{}})),function downloadPackage(){return n.apply(this,arguments)}),l=(r=(0,o.A)((function*(){})),function verifyPackage(){return r.apply(this,arguments)}),c=(s=(0,o.A)((function*(){})),function installPackage(){return s.apply(this,arguments)}),useDownloadProgress=function(){return 0}}}]);
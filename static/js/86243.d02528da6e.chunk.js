"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[86243],{686243:(e,t,n)=>{n.r(t),n.d(t,{default:()=>I});var r=n(324586),o=n(586330),s=n(514041),c=n(724249),i=n(908867),a=n(578104),l=n(490343),u=n(60153),d=n(284781),k=n(498356),f=n(384013),h=n(227428),p=n(318822),w=n(254491),g=n(491180),A=n(298254),y=n(831085);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const I=(0,s.memo)((0,f.dR)((function TokenSelector(){var e,t=(0,i.A)(),{refreshTokenList:n,refreshTokenListMap:r,updateSearchKey:I,updateTokenListState:v,updateSearchTokenState:b,refreshSearchTokenList:T,updateCreateAccountState:S}=(0,f.WE)().current,m=(0,c.lq)(),O=(0,k.A)(),{title:j,networkId:N,accountId:P,tokens:E,closeAfterSelect:L=!0,onSelect:C,tokenListState:D,searchAll:x,isAllNetworks:_,searchPlaceholder:R}=m.params,{network:M,account:z}=(0,A.b)({networkId:N,accountId:P}),[K]=(0,f.u5)(),W=(0,s.useCallback)((e=(0,o.A)((function*(e){if(M?.isAllNetworks){var t,n=yield u.A.serviceNetwork.getVaultSettings({networkId:null!=(t=e.networkId)?t:""}),r=[];if(e.accountId&&e.networkId){var o,s,{accountsInfo:c}=yield u.A.serviceAllNetwork.getAllNetworkAccounts({accountId:null!=(o=e.accountId)?o:"",networkId:null!=(s=e.networkId)?s:"",singleNetworkDeriveType:"default"});r=c}if(n.mergeDeriveAssetsEnabled||r.find((function(t){return t.accountId&&t.accountId===e.accountId&&t.networkId===e.networkId})))C?.(e);else if(z){S({isCreating:!0,token:e});var i=g.A.getWalletIdFromAccountId({accountId:z.id});try{var a=yield u.A.serviceAccount.addHDOrHWAccounts({walletId:i,indexedAccountId:z?.indexedAccountId,deriveType:"default",networkId:e.networkId});S({isCreatingAccount:!1,token:null}),a&&C?.(_objectSpread(_objectSpread({},e),{},{accountId:a.accounts[0].id}))}catch(e){S({isCreatingAccount:!1,token:null})}}}else C?.(e);L&&O.pop()})),function(t){return e.apply(this,arguments)}),[z,L,O,M?.isAllNetworks,C,S]),H=(0,s.useCallback)((0,o.A)((function*(){v({initialized:!1,isRefreshing:!0});var e=yield u.A.serviceToken.fetchAccountTokens({accountId:P,networkId:N,mergeTokens:!0,flag:"token-selector"}),{allTokens:t}=e;if(!t)throw v({isRefreshing:!1}),new Error("allTokens not found from fetchAccountTokensWithMemo ");n({keys:t.keys,tokens:t.data}),r({tokens:t.map}),v({initialized:!0,isRefreshing:!1})})),[P,N,n,r,v]);(0,s.useEffect)((function(){var e,t=(e=(0,o.A)((function*(){E?(n({tokens:E.data,keys:E.keys}),r({tokens:E.map}),v({initialized:!0,isRefreshing:!1})):!M||M?.isAllNetworks||D?.isRefreshing||H()})),function updateTokenList(){return e.apply(this,arguments)});t()}),[H,M,M?.isAllNetworks,N,n,r,D?.isRefreshing,E,v]),(0,s.useEffect)((function(){var e,t=(e=(0,o.A)((function*({tokens:e,keys:t,map:o,merge:s}){var c,i=(yield u.A.serviceNetwork.getVaultSettings({networkId:null!=(c=e[0].networkId)?c:""})).mergeDeriveAssetsEnabled;v({initialized:!0,isRefreshing:!1}),n({tokens:e,keys:t,merge:s,mergeDerive:i}),r({tokens:o,merge:s,mergeDerive:i})})),function updateTokenList(t){return e.apply(this,arguments)});return p.iL.on(p.Tu.TokenListUpdate,t),function(){p.iL.off(p.Tu.TokenListUpdate,t)}}),[n,r,v]);var V,B=(0,a.YQ)(I,x?1e3:200),U=(0,s.useMemo)((function(){return{placeholder:null!=R?R:t.formatMessage({id:w.ETranslations.send_token_selector_search_placeholder}),onChangeText:function({nativeEvent:e}){B(e.text)}}}),[B,t,R]),q=(0,s.useCallback)((V=(0,o.A)((function*(e){b({isSearching:!0}),yield u.A.serviceToken.abortSearchTokens();try{var t=yield u.A.serviceToken.searchTokens({accountId:P,networkId:N,keywords:e});T({tokens:t})}catch(e){}b({isSearching:!1})})),function(e){return V.apply(this,arguments)}),[P,N,T,b]);return(0,s.useEffect)((function(){x&&K&&K.length>=h.NZ?q(K):(b({isSearching:!1}),T({tokens:[]}),u.A.serviceToken.abortSearchTokens())}),[T,x,K,q,b]),(0,y.jsxs)(l.Page,{safeAreaEnabled:!1,children:[(0,y.jsx)(l.Page.Header,{title:null!=j?j:t.formatMessage({id:w.ETranslations.global_select_crypto}),headerSearchBarOptions:U}),(0,y.jsx)(l.Page.Body,{children:(0,y.jsx)(d.x,{withPresetVerticalPadding:!1,onPressToken:W,isAllNetworks:null!=_?_:M?.isAllNetworks,withNetwork:null!=_?_:M?.isAllNetworks,searchAll:x,isTokenSelectorLayout:!0})})]})})))}}]);
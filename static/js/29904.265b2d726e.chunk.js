"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[29904],{326745:(e,t,n)=>{n.d(t,{u:()=>useAppRoute});var o=n(724249);function useAppRoute(){return(0,o.lq)()}},939799:(e,t,n)=>{n.d(t,{A:()=>ValuePriceListItem});var o=n(490343),a=n(831085),ValuePriceListItem=function({amount:e,tokenSymbol:t,fiatSymbol:n,fiatValue:r}){return(0,a.jsxs)(o.XStack,{space:"$1",maxWidth:"$56",justifyContent:"flex-end",flexWrap:"wrap",children:[(0,a.jsx)(o.XStack,{children:(0,a.jsx)(o.NumberSizeableText,{size:"$bodyLgMedium",formatter:"balance",formatterOptions:{tokenSymbol:t},children:e})}),(0,a.jsx)(o.XStack,{maxWidth:"$56",children:(0,a.jsxs)(o.SizableText,{children:["(",(0,a.jsx)(o.NumberSizeableText,{size:"$bodyLgMedium",formatter:"value",formatterOptions:{currency:n},children:r}),")"]})})]})}},918778:(e,t,n)=>{n.d(t,{Kb:()=>useLidoMaticStake,Yv:()=>useLidoMaticClaim,ws:()=>useLidoMaticWithdraw});var o=n(324586),a=n(586330),r=n(514041),i=n(60153),s=n(927799);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,o.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function useLidoMaticStake({accountId:e,networkId:t}){var n,{navigationToSendConfirm:o}=(0,s.E)({accountId:e,networkId:t});return(0,r.useCallback)((n=(0,a.A)((function*({amount:n,stakingInfo:a,onSuccess:r,onFail:s}){var c=yield i.A.serviceAccount.getAccount({accountId:e,networkId:t}),l=yield i.A.serviceStaking.buildLidoMaticStakingTransaction({amount:n,networkId:t});yield o({encodedTx:_objectSpread(_objectSpread({},l),{},{from:c.address}),stakingInfo:a,onSuccess:r,onFail:s})})),function(e){return n.apply(this,arguments)}),[o,e,t])}function useLidoMaticWithdraw({accountId:e,networkId:t}){var n,{navigationToSendConfirm:o}=(0,s.E)({accountId:e,networkId:t});return(0,r.useCallback)((n=(0,a.A)((function*({amount:n,stakingInfo:a,onSuccess:r,onFail:s}){var c=yield i.A.serviceAccount.getAccount({accountId:e,networkId:t}),l=yield i.A.serviceStaking.buildLidoMaticWithdrawalTransaction({amount:n,networkId:t});yield o({encodedTx:_objectSpread(_objectSpread({},l),{},{from:c.address}),stakingInfo:a,onSuccess:r,onFail:s})})),function(e){return n.apply(this,arguments)}),[e,t,o])}function useLidoMaticClaim({accountId:e,networkId:t}){var n,{navigationToSendConfirm:o}=(0,s.E)({accountId:e,networkId:t});return(0,r.useCallback)((n=(0,a.A)((function*({tokenId:n,stakingInfo:a,onSuccess:r,onFail:s}){var c=yield i.A.serviceAccount.getAccount({accountId:e,networkId:t}),l=yield i.A.serviceStaking.buildLidoMaticClaimTransaction({tokenId:n,networkId:t});yield o({encodedTx:_objectSpread(_objectSpread({},l),{},{from:c.address}),stakingInfo:a,onSuccess:r,onFail:s})})),function(e){return n.apply(this,arguments)}),[o,e,t])}},729904:(e,t,n)=>{n.r(t),n.d(t,{default:()=>pages_MaticLidoStake});var o=n(586330),a=n(514041),r=n(241440),i=n(908867),s=n(490343),c=n(498356),l=n(326745),u=n(254491),d=n(213644),f=n(550082),m=n(60153),p=n(88803),k=n(791088),y=n(391944),b=n(927799),g=n(604343),A=n(584186),x=n(369387);function useTrackTokenAllowance({networkId:e,accountId:t,initialValue:n,tokenAddress:r,spenderAddress:i}){var[s,c]=(0,a.useState)(n),[l,u]=(0,a.useState)(""),[d,f]=(0,a.useState)(),p=function useTxTrack({trackTxId:e,accountId:t,networkId:n,timeout:r=A.A.getTimeDurationMs({minute:60}),interval:i=A.A.getTimeDurationMs({seconds:30})}){var[s,c]=(0,a.useState)(null),l=(0,a.useRef)();return(0,a.useEffect)((function(){if(e){var a,s=Date.now(),u=(a=(0,o.A)((function*(e){var o=yield m.A.serviceHistory.fetchTxDetails({networkId:n,accountId:t,txid:e});o&&o.data&&o.data.status!==x.uU.Pending?c(o):Date.now()-s<r?l.current=setTimeout((function(){return u(e)}),i):c(null)})),function checkTxDetails(e){return a.apply(this,arguments)});return l.current=setTimeout((function(){return u(e)}),0),function(){return clearTimeout(l.current)}}}),[e,n,t,r,i]),s}({accountId:t,networkId:e,trackTxId:l});return(0,a.useEffect)((function(){function _fetchAllowance(){return(_fetchAllowance=(0,o.A)((function*(){if(p)try{var n=yield m.A.serviceStaking.fetchTokenAllowance({networkId:e,accountId:t,tokenAddress:r,spenderAddress:i});n&&c(n.allowanceParsed)}finally{f(!1)}else f(!1)}))).apply(this,arguments)}!function fetchAllowance(){return _fetchAllowance.apply(this,arguments)}()}),[p,e,t,i,r]),{allowance:s,trackAllowance:(0,a.useCallback)((function(e){u(e),f(!0)}),[u]),loading:d}}var I=n(827843),w=n(939799),S=n(831085),h={color:"$textSubdued",size:"$bodyLg"},LidoApproveBaseStake=function({price:e,balance:t,token:n,receivingTokenSymbol:c,apr:l=4,minAmount:d="0",rate:f="1",currentAllowance:A="0",onConfirm:x,approveTarget:v}){var T=(0,i.A)(),{navigationToSendConfirm:j}=(0,b.E)({accountId:v.accountId,networkId:v.networkId}),[M,_]=(0,a.useState)(!1),[C,P]=(0,a.useState)(!1),{allowance:O,loading:E,trackAllowance:L}=useTrackTokenAllowance({accountId:v.accountId,networkId:v.networkId,tokenAddress:v.token.address,spenderAddress:v.spenderAddress,initialValue:A}),[$,F]=(0,a.useState)(""),[{currencyInfo:{symbol:N}}]=(0,g.useSettingsPersistAtom)(),z=(0,a.useCallback)((function(e){new r.A(e).isNaN()?""===e&&F(""):F(e)}),[]),B=(0,a.useMemo)((function(){var t=new r.A($);if(!t.isNaN())return t.multipliedBy(e).toFixed()}),[$,e]),D=(0,a.useMemo)((function(){return new r.A($).gt(t)}),[$,t]),U=(0,a.useMemo)((function(){var e=new r.A(d),t=new r.A($);return!(!e.isGreaterThan(0)||!t.isGreaterThan(0))&&t.isLessThan(e)}),[d,$]),R=(0,a.useMemo)((function(){var e=(0,r.A)($);return e.isNaN()||e.lte(0)||D||U}),[$,D,U]),W=(0,a.useMemo)((function(){var e=(0,r.A)($),t=new r.A(O);return!e.isNaN()&&t.lt($)}),[$,O]),K=(0,a.useMemo)((function(){return W?T.formatMessage({id:u.ETranslations.form__approve_str},{amount:$,symbol:n.symbol.toUpperCase()}):T.formatMessage({id:u.ETranslations.earn_stake})}),[W,n,$,T]),V=(0,a.useCallback)((0,o.A)((function*(){P(!0);var e=yield m.A.serviceAccount.getAccount({accountId:v.accountId,networkId:v.networkId});yield j({approveInfo:{owner:e.address,spender:v.spenderAddress,amount:$,tokenInfo:v.token},onSuccess(e){L(e[0].decodedTx.txid),P(!1)},onFail(){P(!1)},onCancel(){P(!1)}})})),[$,v,j,L]),X=(0,a.useCallback)((0,o.A)((function*(){_(!0);try{yield x?.($)}finally{_(!1)}})),[x,$]),Y=(0,a.useCallback)((function(){z(t)}),[z,t]),H=(0,a.useMemo)((function(){var t=(0,r.A)($);if(!$||t.isNaN())return null;var o=(0,r.A)($).multipliedBy(l).dividedBy(100);return(0,S.jsx)(w.A,{tokenSymbol:n.symbol,amount:o.toFixed(),fiatSymbol:N,fiatValue:o.multipliedBy(e).toFixed()})}),[$,l,e,N,n.symbol]),G=(0,a.useMemo)((function(){var e=(0,r.A)($);if(!e.isNaN())return e.multipliedBy(f).toFixed()}),[$,f]);return(0,S.jsxs)(s.YStack,{children:[(0,S.jsxs)(s.Stack,{mx:"$2",px:"$3",space:"$5",children:[(0,S.jsx)(p.J,{hasError:D||U,value:$,onChange:z,tokenSelectorTriggerProps:{selectedTokenImageUri:n.logoURI,selectedTokenSymbol:n.symbol.toUpperCase()},balanceProps:{value:t,onPress:Y},inputProps:{placeholder:"0"},valueProps:{value:B,currency:B?N:void 0},enableMaxAmount:!0}),(0,S.jsxs)(s.YStack,{children:[U?(0,S.jsx)(s.Alert,{icon:"InfoCircleOutline",type:"critical",title:T.formatMessage({id:u.ETranslations.earn_minimum_amount},{number:`${d} ${n.symbol}`})}):null,D?(0,S.jsx)(s.Alert,{icon:"InfoCircleOutline",type:"critical",title:T.formatMessage({id:u.ETranslations.earn_insufficient_balance})}):null]})]}),(0,S.jsx)(s.Stack,{children:(0,S.jsxs)(s.YStack,{children:[H?(0,S.jsx)(k.c,{title:T.formatMessage({id:u.ETranslations.earn_est_annual_rewards}),titleProps:h,children:H}):null,G?(0,S.jsx)(k.c,{title:T.formatMessage({id:u.ETranslations.earn_est_receive}),titleProps:h,children:(0,S.jsx)(s.SizableText,{children:(0,S.jsx)(s.NumberSizeableText,{formatter:"balance",size:"$bodyLgMedium",formatterOptions:{tokenSymbol:c},children:G})})}):null,(0,S.jsx)(k.c,{title:T.formatMessage({id:u.ETranslations.global_apr}),titleProps:h,children:(0,S.jsx)(k.c.Text,{primary:`${l}%`,primaryTextProps:{color:"$textSuccess"}})}),(0,S.jsx)(k.c,{title:T.formatMessage({id:u.ETranslations.global_protocol}),titleProps:h,children:(0,S.jsxs)(s.XStack,{space:"$2",alignItems:"center",children:[(0,S.jsx)(y.o,{size:"xs",tokenImageUri:I.a3}),(0,S.jsx)(s.SizableText,{size:"$bodyLgMedium",children:"Lido"})]})}),(0,S.jsx)(k.c,{title:T.formatMessage({id:u.ETranslations.earn_stake_release_period}),titleProps:h,children:(0,S.jsx)(k.c.Text,{primary:T.formatMessage({id:u.ETranslations.earn_less_than_number_days},{number:4})})})]})}),(0,S.jsx)(s.Page.Footer,{onConfirmText:K,confirmButtonProps:{onPress:W?V:X,loading:M||E||C,disabled:R}})]})},v=n(918778);const pages_MaticLidoStake=function(){var e,t=(0,l.u)(),{networkId:n,accountId:m,token:p,balance:k,price:y,apr:b,stToken:g,currentAllowance:A,rate:x="1"}=t.params,I=(0,c.A)(),w=(0,v.Kb)({networkId:n,accountId:m}),h=(0,a.useCallback)((e=(0,o.A)((function*(e){var t=(0,r.A)(e).shiftedBy(p.decimals).toFixed(0);yield w({amount:t,stakingInfo:{label:f.Z.Stake,protocol:"lido",send:{amount:e,token:p},receive:{token:g,amount:(0,r.A)(e).multipliedBy(x).toFixed()},tags:["lido-matic"]},onSuccess:function(t){I.pop(),d.U.staking.page.staking({token:p,amount:e,stakingProtocol:"lido",tokenValue:(0,r.A)(e).multipliedBy(y).toFixed(),txnHash:t[0].signedTx.txid})}})})),function(t){return e.apply(this,arguments)}),[w,p,I,x,g,y]),T=(0,i.A)();return(0,S.jsxs)(s.Page,{children:[(0,S.jsx)(s.Page.Header,{title:T.formatMessage({id:u.ETranslations.earn_stake_token},{token:"MATIC"})}),(0,S.jsx)(s.Page.Body,{children:(0,S.jsx)(LidoApproveBaseStake,{price:y,balance:k,token:p,receivingTokenSymbol:g.symbol,minAmount:(0,r.A)(1).shiftedBy(-p.decimals).toFixed(),onConfirm:h,apr:b,currentAllowance:A,rate:x,approveTarget:{accountId:m,networkId:n,spenderAddress:g.address,token:p}})})]})}},827843:(e,t,n)=>{n.d(t,{$e:()=>i,Cp:()=>a,LN:()=>r,a3:()=>o});var o="https://uni.onekey-asset.com/static/logo/Lido.png",a="https://uni.onekey-asset.com/static/chain/eth.png",r="https://uni.onekey-asset.com/static/chain/polygon.png",i="https://lido.fi/"},550082:(e,t,n)=>{n.d(t,{Z:()=>o});var o=function(e){return e.Stake="Stake",e.Claim="Claim",e.Redeem="Redeem",e}({})}}]);
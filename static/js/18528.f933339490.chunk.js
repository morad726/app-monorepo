"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[18528],{82506:(e,t,n)=>{n.d(t,{d:()=>useDebounce});var r=n(578104);function useDebounce(e,t,n){var[o]=(0,r.d7)(e,t,n);return o}},657412:(e,t,n)=>{n.d(t,{Xp:()=>r.Xp,yZ:()=>useBrowserAction,Gd:()=>useBrowserBookmarkAction,cS:()=>useBrowserHistoryAction,AO:()=>useBrowserTabActions,AS:()=>r.AS,Do:()=>r.Do,pJ:()=>r.pJ,nD:()=>r.nD});var r=n(603614),o=n(586330),a=n(324586),i=n(946343),c=n.n(i),s=n(230414),u=n(929296),l=n(195309),d=n(972715),p=n(514041),b=n(490343),f=n(60153),m=n(262873),y=n(714178),g=n(971670),A=n(660015),v=n(254491),w=n(849726),h=n(213644),k=(n(663522),n(757559)),D=n(657355),S=n(482407),I=n(796151),W=n(42484);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _createSuper(e){var t=_isNativeReflectConstruct();return function _createSuperInternal(){var n,r=(0,d.A)(e);if(t){var o=(0,d.A)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,l.A)(this,n)}}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function loggerForEmptyData(e,t){e&&0!==e.length||(h.U.discovery.browser.setTabsDataFunctionName(t),h.U.discovery.browser.tabsData(e))}var j={};var T={id:"home",url:"about:blank",title:"OneKey",canGoBack:!1,loading:!1,favicon:""},B=function(e){(0,u.A)(ContextJotaiActionsDiscovery,e);var t=_createSuper(ContextJotaiActionsDiscovery);function ContextJotaiActionsDiscovery(...e){var n,a,i,s,u,l,d,p,y;return(n=t.call(this,...e)).setDisplayHomePage=(0,r.q0)((function(e,t,n){t((0,r.QL)(),n)})),n.setBrowserDataReady=(0,r.q0)((function(e,t){t((0,r.lr)(),!0)})),n.buildWebTabs=(0,r.q0)((function(e,t,n){var{data:o,options:a}=n;if(e((0,r.lr)())||a?.isInitFromStorage){var i=e((0,r.cl)()),s=o;if(!Array.isArray(o))throw new Error("setWebTabsWriteAtom: payload must be an array");s&&s.length||(s=[]);var u=function buildWebTabData(e){var t={},n=[];return e.sort((function(e,t){return e.timestamp&&t.timestamp?e.timestamp-t.timestamp:0})),e.forEach((function(e){n.push(e.id),t[e.id]=e})),{data:e,keys:n,map:t}}(s);c()(u.keys,i.keys)&&!a?.forceUpdate||t((0,r.cl)(),{keys:u.keys,tabs:u.data}),t((0,r.GW)(),(function(){return u.map})),loggerForEmptyData(u.data,"buildWebTabs->saveToSimpleDB"),f.A.simpleDb.browserTabs.setRawData({tabs:u.data})}})),n.refreshTabs=(0,r.q0)((function(e,t){var{tabs:o}=e((0,r.cl)()),a=[...o];loggerForEmptyData(a,"refreshTabs"),n.buildWebTabs.call(t,{data:a,options:{forceUpdate:!0}})})),n.setCurrentWebTab=(0,r.q0)((function(e,t,o){var a=e((0,r.WL)());if(a!==o){n.pauseDappInteraction.call(t,a);var{tabs:i}=e((0,r.cl)()),c=i.findIndex((function(e){return e.id===o}));i.forEach((function(e){e.isActive=!1})),loggerForEmptyData([...i],"setCurrentWebTab"),n.buildWebTabs.call(t,{data:[...i]}),-1!==c?(i[c].isActive=!0,t((0,r.WL)(),o),n.resumeDappInteraction.call(t,o)):t((0,r.WL)(),"")}var s=e((0,r.QL)());o&&s&&n.setDisplayHomePage.call(t,!1),o||s||n.setDisplayHomePage.call(t,!0)})),n.addWebTab=(0,r.q0)((function(e,t,o){performance.now();var a,{tabs:i}=e((0,r.cl)());o.id&&o.id!==T.id||(o.id=(0,S.lk)()),o.timestamp=Date.now(),n.buildWebTabs.call(t,{data:[...i,o]}),n.setCurrentWebTab.call(t,null!=(a=o.id)?a:"");performance.now()})),n.addBlankWebTab=(0,r.q0)((function(e,t){n.addWebTab.call(t,_objectSpread(_objectSpread({},T),{},{isActive:!0}))})),n.setWebTabData=(0,r.q0)((function(e,t,o){var{tabs:a}=e((0,r.cl)()),i=a,c=i.findIndex((function(e){return e.id===o.id}));if(c>-1){var s=i[c];Object.keys(o).forEach((function(e){var t=e,n=o[t];if(void 0!==n&&n!==s[t]){if("title"===t&&!n)return;s[t]=n,"url"===t&&(s.timestamp=Date.now(),"about:blank"===n&&o.id&&(j[o.id]=s.timestamp))}})),i[c]=s,loggerForEmptyData(i,"setWebTabData"),n.buildWebTabs.call(t,{data:i})}})),n.closeWebTab=(0,r.q0)((function(e,t,o){delete A.O3[o];var{tabs:a}=e((0,r.cl)()),i=e((0,r.WL)()),c=a.findIndex((function(e){return e.id===o}));if(-1!==c){var s=a[c].id===i;if(a.splice(c,1),s){var u=c-1;if(u<0&&a.length>0&&(u=0),u>=0){var l=a[u];l.isActive=!0,n.setCurrentWebTab.call(t,l.id)}}}loggerForEmptyData([...a],"closeWebTab"),n.buildWebTabs.call(t,{data:[...a]})})),n.closeAllWebTabs=(0,r.q0)((function(e,t){var{tabs:o}=e((0,r.cl)()),a=e((0,r.WL)()),i=o.filter((function(e){return e.isPinned}));i.every((function(e){return e.id!==a}))&&n.setCurrentWebTab.call(t,null);var _loop=function(e){i.find((function(t){return t.id===e}))||delete A.O3[e]};for(var c of Object.getOwnPropertyNames(A.O3))_loop(c);loggerForEmptyData(i,"closeAllWebTabs"),n.buildWebTabs.call(t,{data:i})})),n.setPinnedTab=(0,r.q0)((function(e,t,r){n.setWebTabData.call(t,{id:r.id,isPinned:r.pinned,timestamp:Date.now()}),n.refreshTabs.call(t)})),n.syncBookmark=(0,r.q0)((function(e,t,o){var a=e((0,r.GW)());a&&Object.entries(a).forEach((function([,e]){e.url===o.url&&n.setWebTabData.call(t,{id:e.id,isBookmark:o.isBookmark})}))})),n.getBookmarkData=(0,r.q0)((0,o.A)((function*(){var e;return null!=(e=(yield f.A.simpleDb.browserBookmarks.getRawData())?.data)?e:[]}))),n.buildBookmarkData=(0,r.q0)((function(e,t,n){var{data:o,options:a}=n;if(e((0,r.lr)())||a?.isInitFromStorage){if(!Array.isArray(o))throw new Error("buildBookmarkData: payload must be an array");f.A.serviceDiscovery.setBrowserBookmarks(o)}})),n.addBrowserBookmark=(0,r.q0)((a=(0,o.A)((function*(e,t,r){if(r.url&&r.url!==T.url){var o=[...(yield n.getBookmarkData.call(t)).filter((function(e){return e.url!==r.url})),{url:r.url,title:r.title}];n.buildBookmarkData.call(t,{data:o}),n.syncBookmark.call(t,{url:r.url,isBookmark:!0}),f.A.serviceCloudBackup.requestAutoBackup()}})),function(e,t,n){return a.apply(this,arguments)})),n.removeBrowserBookmark=(0,r.q0)((i=(0,o.A)((function*(e,t,r){var o=(yield n.getBookmarkData.call(t)).filter((function(e){return e.url!==r}));n.buildBookmarkData.call(t,{data:o}),n.syncBookmark.call(t,{url:r,isBookmark:!1})})),function(e,t,n){return i.apply(this,arguments)})),n.modifyBrowserBookmark=(0,r.q0)((s=(0,o.A)((function*(e,t,r){if(r.url&&r.url!==T.url){var o=(yield n.getBookmarkData.call(t)).map((function(e){return e.url===r.url?_objectSpread(_objectSpread({},e),r):e}));n.buildBookmarkData.call(t,{data:o})}})),function(e,t,n){return s.apply(this,arguments)})),n.getHistoryData=(0,r.q0)((0,o.A)((function*(){var e;return null!=(e=(yield f.A.simpleDb.browserHistory.getRawData())?.data)?e:[]}))),n.buildHistoryData=(0,r.q0)((function(e,t,n){var{data:o,options:a}=n;if(e((0,r.lr)())||a?.isInitFromStorage){if(!Array.isArray(o))throw new Error("buildHistoryData: payload must be an array");f.A.simpleDb.browserHistory.setRawData({data:o})}})),n.addBrowserHistory=(0,r.q0)((u=(0,o.A)((function*(e,t,r){if(r.url&&r.url!==T.url){var o=(yield n.getHistoryData.call(t)).filter((function(e){return e.url!==r.url})),a={id:(0,S.lk)(),url:r.url,title:r.title,createdAt:Date.now()};n.buildHistoryData.call(t,{data:[a,...o]})}})),function(e,t,n){return u.apply(this,arguments)})),n.removeBrowserHistory=(0,r.q0)((l=(0,o.A)((function*(e,t,r){var o=(yield n.getHistoryData.call(t)).filter((function(e){return e.id!==r}));n.buildHistoryData.call(t,{data:o})})),function(e,t,n){return l.apply(this,arguments)})),n.removeAllBrowserHistory=(0,r.q0)((d=(0,o.A)((function*(e,t){n.buildHistoryData.call(t,{data:[]})})),function(e,t){return d.apply(this,arguments)})),n.getWebTabById=(0,r.q0)((function(e,t,n){var o=e((0,r.GW)());return o?.[n||""]})),n.gotoSite=(0,r.q0)((p=(0,o.A)((function*(e,t,{id:r,url:o,title:a,favicon:i,isNewWindow:c,isInPlace:s,userTriggered:u}){var l=n.getWebTabById.call(t,null!=r?r:"");if(o){var d=I.Ay.validateUrl(o);if(!d)return;if(u&&n.addBrowserHistory.call(t,{url:d,title:null!=a?a:""}),"StandardBrowser"===A.n5)return(0,g.C)(d);var p=l?.id,b=!d.startsWith("http")&&"about:blank"!==d,f="boolean"==typeof c?c:(c||!p||"home"===p||b)&&"MultiTabBrowser"===A.n5,m=yield n.getBookmarkData.call(t),y=m?.some((function(e){return e.url.includes(d)}));return f?n.addWebTab.call(t,{title:a,url:d,favicon:i,isBookmark:y}):n.setWebTabData.call(t,{id:p,url:d,title:a,favicon:i,isBookmark:y}),f||s||(0,A.T0)({url:d,tabId:p}),b&&"MultiTabBrowser"===A.n5&&p&&setTimeout((function(){n.closeWebTab.call(t,p)}),1e3),!0}return!1})),function(e,t,n){return p.apply(this,arguments)})),n.openMatchDApp=(0,r.q0)((y=(0,o.A)((function*(e,t,{dApp:r,webSite:o,isNewWindow:a,tabId:i}){return o?n.gotoSite.call(t,{id:i,url:o.url,title:o.title,favicon:yield f.A.serviceDiscovery.buildWebsiteIconUrl(o.url),isNewWindow:a,userTriggered:!0}):r?n.gotoSite.call(t,{id:i,url:r.url,title:r.name,dAppId:r.dappId,favicon:r.logo||r.originLogo,userTriggered:!0,isNewWindow:a}):void 0})),function(e,t,n){return y.apply(this,arguments)})),n.handleOpenWebSite=(0,r.q0)((function(e,t,{useCurrentWindow:o,tabId:a,navigation:i,webSite:c,dApp:s,shouldPopNavigation:u=!0}){var l=!o;if(!o&&e((0,r.$D)()))return void b.Toast.message({title:w.a.intl.formatMessage({id:v.ETranslations.explore_toast_tab_limit_reached},{number:"20"})});n.setDisplayHomePage.call(t,!1),n.openMatchDApp.call(t,{webSite:c,dApp:s,isNewWindow:l,tabId:a}),u&&i.switchTab(k.V4.Discovery)})),n.onNavigation=(0,r.q0)((function(e,t,{url:o,isNewWindow:a,isInPlace:i,title:c,favicon:s,canGoBack:u,canGoForward:l,loading:d,id:p,handlePhishingUrl:b}){var f=Date.now(),y=n.getWebTabById.call(t,null!=p?p:"");if(y){var g="string"==typeof o&&o!==y.url;if(o){var A=e((0,r.RY)()),{action:v}=I.Ay.parseDappRedirect(o,Array.from(A.keys()));if(v===I.Ay.EDAppOpenActionEnum.DENY)return h.U.discovery.browser.logRejectUrl(o),void b?.(o);if(I.Ay.isValidDeepLink(o))return void(0,m.q)({url:o})}if(g){if(y.timestamp&&f-y.timestamp<500)return;if(j[y.id]&&o!==T.url&&f-j[y.id]<1e3)return;n.gotoSite.call(t,{url:o,title:c,favicon:s,isNewWindow:a,isInPlace:i,id:y.id})}n.setWebTabData.call(t,{id:y.id,title:c,favicon:s,canGoBack:u,canGoForward:l,loading:d})}})),n.addUrlToPhishingCache=(0,r.q0)((function(e,t,n){try{var{origin:o}=new URL(n.url),a=e((0,r.RY)());a.set(o,!0),t((0,r.RY)(),a),window.desktopApi?.setAllowedPhishingUrls(Array.from(a.keys()))}catch{}})),n.updateDappActivityInteraction=(0,r.q0)((function(e,t,n){var o=n.id;o||(o=e((0,r.WL)()));var a=o?A.O3[o]:null;if(a){var i="pause"===n.type;i?A.ay:A.F;a.jsBridge&&(a.jsBridge.globalOnMessageEnabled=!i)}})),n.pauseDappInteraction=(0,r.q0)((function(e,t,r){n.updateDappActivityInteraction.call(t,{id:r,type:"pause"})})),n.resumeDappInteraction=(0,r.q0)((function(e,t,r){n.updateDappActivityInteraction.call(t,{id:r,type:"resume"})})),n.validateWebviewSrc=(0,r.q0)((function(e,t,n){if(!n)return W.i.InvalidUrl;var o=e((0,r.RY)()),{action:a}=I.Ay.parseDappRedirect(n,Array.from(o.keys()));return a===I.Ay.EDAppOpenActionEnum.DENY?(h.U.discovery.browser.logRejectUrl(n),W.i.NotSupportProtocol):I.Ay.containsPunycode(n)?(h.U.discovery.browser.logRejectUrl(n),W.i.InvalidPunycode):I.Ay.isValidDeepLink(n)?W.i.ValidDeeplink:W.i.Valid})),n}return(0,s.A)(ContextJotaiActionsDiscovery)}(y.x),x=(0,D.j)((function(){return new B}));function useBrowserTabActions(){var e=x(),t=e.addWebTab.use(),n=e.addBlankWebTab.use(),r=e.buildWebTabs.use(),o=e.refreshTabs.use(),a=e.setWebTabData.use(),i=e.getWebTabById.use(),c=e.closeWebTab.use(),s=e.closeAllWebTabs.use(),u=e.setCurrentWebTab.use(),l=e.setPinnedTab.use(),d=e.setDisplayHomePage.use(),b=e.setBrowserDataReady.use();return(0,p.useRef)({addWebTab:t,addBlankWebTab:n,buildWebTabs:r,refreshTabs:o,setWebTabData:a,getWebTabById:i,closeWebTab:c,closeAllWebTabs:s,setCurrentWebTab:u,setPinnedTab:l,setDisplayHomePage:d,setBrowserDataReady:b})}function useBrowserBookmarkAction(){var e=x(),t=e.buildBookmarkData.use(),n=e.getBookmarkData.use(),r=e.addBrowserBookmark.use(),o=e.removeBrowserBookmark.use(),a=e.modifyBrowserBookmark.use();return(0,p.useRef)({buildBookmarkData:t,getBookmarkData:n,addBrowserBookmark:r,removeBrowserBookmark:o,modifyBrowserBookmark:a})}function useBrowserHistoryAction(){var e=x(),t=e.buildHistoryData.use(),n=e.getHistoryData.use(),r=e.addBrowserHistory.use(),o=e.removeBrowserHistory.use(),a=e.removeAllBrowserHistory.use();return(0,p.useRef)({buildHistoryData:t,getHistoryData:n,addBrowserHistory:r,removeBrowserHistory:o,removeAllBrowserHistory:a})}function useBrowserAction(){var e=x(),t=e.gotoSite.use(),n=e.openMatchDApp.use(),r=e.handleOpenWebSite.use(),o=e.onNavigation.use(),a=e.addUrlToPhishingCache.use(),i=e.pauseDappInteraction.use(),c=e.resumeDappInteraction.use(),s=e.validateWebviewSrc.use();return(0,p.useRef)({gotoSite:t,openMatchDApp:n,handleOpenWebSite:r,onNavigation:o,addUrlToPhishingCache:a,pauseDappInteraction:i,resumeDappInteraction:c,validateWebviewSrc:s})}},278484:(e,t,n)=>{n.d(t,{wI:()=>DAppAccountListItem,ZY:()=>DAppAccountListStandAloneItem,X1:()=>DAppAccountListStandAloneItemForHomeScene,VV:()=>WalletConnectAccountTriggerList});var r=n(460986),o=n.n(r),a=n(324586),i=n(586330),c=n(514041),s=n(908867),u=n(17617),l=n(490343),d=n(60153),p=n(325809),b=n(237532),f=n(24284),m=n(911998),y=n(162616),g=n(226952),A=n(254491),v=(n(663522),n(584186)),w=n(714191),h=n(82506);var k=n(831085);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function DAppAccountListInitFromHome({num:e,shouldSyncFromHome:t}){var[,n]=(0,y.K7)(),r=(0,y.z$)();return(0,c.useEffect)((function(){return(0,i.A)((function*(){try{n((function(t){return _objectSpread(_objectSpread({},t),{},{[e]:{isLoading:!0}})})),yield v.A.wait(600),t&&(yield r.current.syncFromScene({from:{sceneName:w.Zs.home,sceneNum:0},num:e}))}finally{t&&(yield v.A.wait(300)),n((function(t){return _objectSpread(_objectSpread({},t),{},{[e]:{isLoading:!1}})}))}}))(),function(){n((function(t){return _objectSpread(_objectSpread({},t),{},{[e]:{isLoading:!1}})}))}}),[r,e,n,t]),null}function DAppAccountListItem({num:e,handleAccountChanged:t,readonly:n,networkReadonly:r,compressionUiMode:o,initFromHome:a,beforeShowTrigger:i,skeletonRenderDuration:s}){!function useHandleDiscoveryAccountChanged({num:e,handleAccountChanged:t}){var{activeAccount:n}=(0,y.LH)({num:e}),{selectedAccount:r}=(0,y.wz)({num:e}),o=(0,h.d)(n,200),a=(0,h.d)(r,200),i=(0,c.useRef)(n),s=(0,c.useRef)(r);(0,c.useEffect)((function(){i.current=n,s.current=r}),[n,r]),(0,c.useEffect)((function(){t&&(o.isOthersWallet&&o.account?.id===a.othersWalletAccountId||o.indexedAccount?.id===a.indexedAccountId)&&t({activeAccount:i.current,selectedAccount:s.current},e)}),[o,a,t,e])}({num:e,handleAccountChanged:t});var d=Boolean(a&&!n);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(l.YGroup,{bg:"$bg",borderRadius:"$3",borderColor:"$borderSubdued",borderWidth:u.A.hairlineWidth,separator:(0,k.jsx)(l.Divider,{}),disabled:n,children:[(0,k.jsx)(l.YGroup.Item,{children:(0,k.jsx)(p.jY,{num:e,beforeShowTrigger:i,disabled:r||n,loadingDuration:0})}),(0,k.jsx)(l.YGroup.Item,{children:(0,k.jsx)(b.U,{num:e,compressionUiMode:o,beforeShowTrigger:i,loadingDuration:0})})]}),(0,k.jsx)(DAppAccountListInitFromHome,{num:e,shouldSyncFromHome:d})]})}function DAppAccountListStandAloneItem({readonly:e,handleAccountChanged:t,onConnectedAccountInfoChanged:n}){var r=(0,s.A)(),{serviceDApp:a,serviceNetwork:u}=d.A,{$sourceInfo:b}=(0,f.A)(),{result:y}=(0,m.yk)((0,i.A)((function*(){var e,t;if(!b?.origin||!b.scope)return{accountSelectorNum:null,networkIds:null};var n=(0,g.zg)(b.scope),r=n?(yield u.getNetworkIdsByImpls({impls:n})).networkIds:null,o=yield a.getConnectedAccountsInfo({origin:b.origin,scope:null!=(e=b.scope)?e:"",isWalletConnectRequest:b.isWalletConnectRequest});return Array.isArray(o)&&o.length>0&&"number"==typeof o[0]?.num?{accountSelectorNum:o[0].num,networkIds:r,existConnectedAccount:!0}:{accountSelectorNum:yield a.getAccountSelectorNum({origin:b.origin,scope:null!=(t=b.scope)?t:"",isWalletConnectRequest:b.isWalletConnectRequest}),networkIds:r,existConnectedAccount:!1}})),[b?.origin,b?.scope,b?.isWalletConnectRequest,a,u]);return(0,c.useEffect)((function(){o()(y?.accountSelectorNum)&&n&&n({num:y.accountSelectorNum,existConnectedAccount:y.existConnectedAccount})}),[y?.accountSelectorNum,y?.existConnectedAccount,n]),(0,k.jsxs)(l.YStack,{space:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,k.jsx)(l.SizableText,{size:"$headingMd",color:"$text",children:r.formatMessage({id:A.ETranslations.global_accounts})}),"number"==typeof y?.accountSelectorNum&&Array.isArray(y?.networkIds)?(0,k.jsx)(p.b8,{config:{sceneName:w.Zs.discover,sceneUrl:b?.origin},enabledNum:[y.accountSelectorNum],availableNetworksMap:{[y.accountSelectorNum]:{networkIds:y.networkIds}},children:(0,k.jsx)(DAppAccountListItem,{initFromHome:!y?.existConnectedAccount,num:y?.accountSelectorNum,handleAccountChanged:t,readonly:e})}):null]})}function DAppAccountListStandAloneItemForHomeScene(){var e=(0,s.A)();return(0,k.jsxs)(l.YStack,{space:"$2",testID:"DAppAccountListStandAloneItem",children:[(0,k.jsx)(l.SizableText,{size:"$headingMd",color:"$text",children:e.formatMessage({id:A.ETranslations.global_accounts})}),(0,k.jsx)(p.b8,{config:{sceneName:w.Zs.home},enabledNum:[0],children:(0,k.jsx)(DAppAccountListItem,{initFromHome:!1,num:0,readonly:!0})})]})}function WalletConnectAccountTriggerList({sceneUrl:e,sessionAccountsInfo:t,handleAccountChanged:n}){var r=t.map((function(e){return e.accountSelectorNum})),o=t.reduce((function(e,t){var n=t.networkIds.filter(Boolean);return e[t.accountSelectorNum]={networkIds:n,defaultNetworkId:n[0]},e}),{});return(0,k.jsxs)(l.YStack,{space:"$2",children:[(0,k.jsx)(l.SizableText,{size:"$headingMd",color:"$text",children:"Accounts"}),Array.isArray(t)&&t.length?(0,k.jsx)(p.b8,{config:{sceneName:w.Zs.discover,sceneUrl:e},enabledNum:r,availableNetworksMap:o,children:(0,k.jsx)(l.YStack,{space:"$2",children:t.map((function(e){return(0,k.jsx)(l.Stack,{children:(0,k.jsx)(DAppAccountListItem,{initFromHome:!0,num:e.accountSelectorNum,handleAccountChanged:n})},e.accountSelectorNum)}))})}):null]})}},618528:(e,t,n)=>{n.r(t),n.d(t,{default:()=>A});var r=n(586330),o=n(514041),a=n(908867),i=n(490343),c=n(254491),s=n(60153),u=n(911998),l=n(233693),d=n(324586),p=n(325809),b=n(928557),f=n(714191),m=n(278484),y=n(831085);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,d.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const g=function ConnectionListItem({item:e,handleDisconnect:t,handleAccountChanged:n}){return(0,y.jsxs)(i.YStack,{space:"$5",p:"$5",children:[(0,y.jsxs)(i.XStack,{alignItems:"center",justifyContent:"space-between",space:"$3",children:[(0,y.jsxs)(i.XStack,{flex:1,alignItems:"center",space:"$3",children:[(0,y.jsxs)(i.Image,{size:"$10",borderRadius:"$full",children:[(0,y.jsx)(i.Image.Source,{src:e.imageURL}),(0,y.jsx)(i.Image.Fallback,{children:(0,y.jsx)(i.Icon,{size:"$10",name:"GlobusOutline"})}),(0,y.jsx)(i.Image.Loading,{children:(0,y.jsx)(i.Skeleton,{width:"100%",height:"100%"})})]}),(0,y.jsx)(i.SizableText,{size:"$bodyLgMedium",color:"$text",numberOfLines:3,style:{wordBreak:"break-all"},children:new URL(e.origin).hostname})]}),(0,y.jsx)(i.XStack,{p:"$1.5",m:"-$1.5",borderRadius:"$2",hoverStyle:{bg:"$bgHover"},pressStyle:{bg:"$bgActive"},focusable:!0,focusStyle:{outlineWidth:2,outlineColor:"$focusRing",outlineStyle:"solid"},onPress:function(){t(e.origin,e.storageType)},children:(0,y.jsx)(i.Icon,{name:"BrokenLinkOutline",color:"$iconSubdued",size:"$6"})})]}),(0,y.jsx)(p.b8,{config:{sceneName:f.Zs.discover,sceneUrl:e.origin},enabledNum:Object.keys(e.connectionMap).map((function(e){return Number(e)})),availableNetworksMap:e.availableNetworksMap,children:(0,y.jsx)(i.YStack,{space:"$2",children:Object.keys(e.connectionMap).map((function(t){return(0,y.jsx)(m.wI,{num:Number(t),handleAccountChanged:function(r){n({handleAccountChangedParams:r,num:Number(t),origin:e.origin,prevAccountInfo:_objectSpread(_objectSpread({},e.connectionMap[Number(t)]),{},{num:Number(t),storageType:e.storageType})})},readonly:(r=e.connectionMap[Number(t)],"walletConnect"===e.storageType&&r.networkImpl===b.bO)},t);var r}))})})]})};var ItemSeparatorComponent=function(){return(0,y.jsx)(i.Divider,{})};function ConnectionListEmpty(){var e=(0,a.A)();return(0,y.jsx)(i.Empty,{flex:1,icon:"LinkSolid",title:e.formatMessage({id:c.ETranslations.explore_no_dapps_connected}),description:e.formatMessage({id:c.ETranslations.explore_no_dapps_connected_message})})}const A=function ConnectionList(){var e=(0,a.A)(),{serviceDApp:t}=s.A,[n,d]=(0,o.useState)([]),[p,b]=(0,o.useState)(0),{result:f,run:m}=(0,u.yk)((0,r.A)((function*(){return t.getAllConnectedList()})),[t],{checkIsFocused:!1});(0,o.useEffect)((function(){d((function(){var e=6*p+6;return(null!=f?f:[]).slice(0,e)}))}),[f,p]);var A,v=(0,o.useCallback)((0,r.A)((function*(){var e=p+1,t=6*e,n=t+6,r=(null!=f?f:[]).slice(t,n);r.length>0&&(d((function(e){return[...e,...r]})),b(e))})),[f,p]),w=(0,o.useCallback)((A=(0,r.A)((function*(e,n){yield t.disconnectWebsite({origin:e,storageType:n}),m()})),function(e,t){return A.apply(this,arguments)}),[m,t]),h=(0,o.useCallback)((function(){return(0,y.jsx)(i.Button,{variant:"tertiary",size:"medium",onPress:(0,r.A)((function*(){yield t.disconnectAllWebsites(),m()})),children:e.formatMessage({id:c.ETranslations.explore_remove_all})})}),[m,t,e]),{handleAccountInfoChanged:k}=(0,l.Q)();return(0,y.jsxs)(i.Page,{children:[(0,y.jsx)(i.Page.Header,{title:e.formatMessage({id:c.ETranslations.explore_dapp_connections}),headerRight:function(){return h()}}),(0,y.jsx)(i.Page.Body,{children:(0,y.jsx)(i.ListView,{contentContainerStyle:{flex:1},estimatedItemSize:199,scrollEnabled:!0,data:n,ListEmptyComponent:ConnectionListEmpty,keyExtractor:function(e){return e.origin},renderItem:function({item:e}){return(0,y.jsx)(g,{item:e,handleDisconnect:w,handleAccountChanged:function({origin:e,num:t,handleAccountChangedParams:n,prevAccountInfo:r}){k({origin:e,accountSelectorNum:t,prevAccountInfo:r,accountChangedParams:n,storageType:r.storageType,afterUpdate:function(){return m()}})}})},ItemSeparatorComponent,onEndReached:function(){v()},onEndReachedThreshold:1})})]})}},233693:(e,t,n)=>{n.d(t,{Q:()=>useShouldUpdateConnectedAccount});var r=n(586330),o=n(797331),a=n.n(o),i=n(514041);n(663522),n(757559);var c=n(184251),s=n(60153),u=(n(317522),n(394764),n(660015),n(574319),{"https://wallet.keplr.app":!0});a()((function(e,t){var n=new URL(e).origin;"domReady"===t&&u[n]||(s.A.serviceDApp.notifyDAppAccountsChanged(n),s.A.serviceDApp.notifyDAppChainChanged(n))}),800);function useShouldUpdateConnectedAccount(){var e,t=(0,i.useCallback)((function(e,t){var n=e.walletId!==t.walletId||e.indexedAccountId!==t.indexedAccountId||e.networkId!==t.networkId||e.accountId!==t.accountId||e.address!==t.address,r=t.accountId&&t.walletId&&(c.A.isLightningNetworkByNetworkId(t.networkId)||t.address)&&t.networkId;return e&&n&&r}),[]),n=(0,i.useCallback)((function({activeAccount:e,selectedAccount:t}){var n,r,o,a,i,c;return{walletId:null!=(n=e.wallet?.id)?n:"",indexedAccountId:null!=(r=e.indexedAccount?.id)?r:"",networkId:null!=(o=e.network?.id)?o:"",accountId:null!=(a=e.account?.id)?a:"",address:null!=(i=e.account?.address)?i:"",networkImpl:null!=(c=e.network?.impl)?c:"",deriveType:e.deriveType,focusedWallet:t.focusedWallet,othersWalletAccountId:t.othersWalletAccountId}}),[]),o=(0,i.useCallback)((e=(0,r.A)((function*({origin:e,accountSelectorNum:r,prevAccountInfo:o,accountChangedParams:a,storageType:i,afterUpdate:c}){var u=n(a);if(t(o,u)){var{serviceDApp:l}=s.A;yield s.A.serviceDApp.updateConnectionSession({origin:e,accountSelectorNum:r,updatedAccountInfo:u,storageType:i}),c(),o.accountId!==u.accountId&&l.notifyDAppAccountsChanged(e),o.networkId!==u.networkId&&l.notifyDAppChainChanged(e)}})),function(t){return e.apply(this,arguments)}),[n,t]);return{handleAccountInfoChanged:o}}},574319:(e,t,n)=>{n.d(t,{D$:()=>useWebTabDataById,bI:()=>useDisabledAddedNewTab,cf:()=>useActiveTabId,oM:()=>useWebTabs,y:()=>useDisplayHomePageFlag});var r=n(514041),o=n(657412),useWebTabs=function(){var[e]=(0,o.pJ)();return(0,r.useMemo)((function(){return{tabs:e.tabs}}),[e])},useWebTabDataById=function(e){var[t]=(0,o.nD)();return(0,r.useMemo)((function(){return{tab:t[null!=e?e:""]}}),[t,e])},useActiveTabId=function(){var[e]=(0,o.Xp)();return(0,r.useMemo)((function(){return{activeTabId:e}}),[e])},useDisplayHomePageFlag=function(){var[e]=(0,o.Do)();return{displayHomePage:e}},useDisabledAddedNewTab=function(){var[e]=(0,o.AS)();return(0,r.useMemo)((function(){return{disabledAddedNewTab:e}}),[e])}},660015:(e,t,n)=>{n.d(t,{F:()=>c,Mr:()=>formatHiddenHttpsUrl,O3:()=>a,T0:()=>crossWebviewLoadUrl,ay:()=>i,n5:()=>o});var r=n(663522),o="StandardBrowser",a={};function getWebviewWrapperRef(e){var t=e?a[e]:null;return null!=t?t:null}function formatHiddenHttpsUrl(e){return{isHttpsUrl:e&&/^https/i.test(e),hiddenHttpsUrl:e?.replace?.(/^https:\/\//i,"")}}function crossWebviewLoadUrl({url:e,tabId:t}){var n=getWebviewWrapperRef(t);r.Ay.isRuntimeBrowser?n?.innerRef?.loadURL(e):n?.innerRef?.loadUrl(e)}var i="\n(function(){\n  if (window.WebSocket) {\n    if (!window.$$onekeyWebSocketSend) {\n      window.$$onekeyWebSocketSend = window.WebSocket.prototype.send;\n    }\n    window.WebSocket.prototype.send = () => {};\n  }\n})()\n",c="\n(function(){\n  if (\n    window.WebSocket &&\n    window.$$onekeyWebSocketSend\n  ) {\n    window.WebSocket.prototype.send = window.$$onekeyWebSocketSend;\n  }\n})()\n"}}]);
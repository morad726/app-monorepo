"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[3036],{424403:(e,t,n)=>{n.d(t,{KR:()=>useCheckAccountExist,Mo:()=>useAccountInfoForManageToken,YF:()=>useAddToken,yT:()=>useAddTokenForm});var o=n(586330),r=n(514041),s=n(241440),a=n(578104),c=n(490343),i=n(848312),d=n(184251),u=n(60153),l=n(911998);function useAddTokenForm({token:e,networkId:t}){var n=d.A.isAllNetwork({networkId:t}),o=(0,r.useCallback)((function(){return e&&e.networkId?e.networkId:n?(0,i.V$)().eth:t}),[n,t,e]),a=(0,c.useForm)({values:{networkId:o(),contractAddress:e?.address||"",symbol:e?.symbol||"",decimals:e?.decimals?new s.A(e.decimals).toString():""},mode:"onChange",reValidateMode:"onBlur"}),u=a.watch("networkId"),l=a.watch("contractAddress"),k=a.watch("symbol"),f=a.watch("decimals"),[m,w]=(0,r.useState)(!1),h=(0,r.useRef)(!0),I=(0,r.useCallback)((function(t){h.current||(e?.address||l)&&w(t)}),[l,e?.address]);return(0,r.useEffect)((function(){h.current?h.current=!1:a.trigger("contractAddress")}),[m,a]),{form:a,isEmptyContract:m,setIsEmptyContractState:I,selectedNetworkIdValue:u,contractAddressValue:l,symbolValue:k,decimalsValue:f}}function useAddToken({token:e,walletId:t,networkId:n,form:c,selectedNetworkIdValue:i,contractAddressValue:d,setIsEmptyContractState:k}){var f,{result:m}=(0,l.yk)((0,o.A)((function*(){var t=(yield u.A.serviceNetwork.getCustomTokenEnabledNetworks({currentNetworkId:n})).map((function(e){return e.id})),o=yield u.A.serviceNetwork.getNetwork({networkId:n});return e?.networkId&&!t.includes(e.networkId)&&t.push(e.networkId),{networkIds:t,network:o}})),[n,e?.networkId]),w=(0,r.useRef)(),h=(0,a.YQ)((f=(0,o.A)((function*(n){var o;if(!e&&!n.value.trim())return c.setValue("symbol",""),c.setValue("decimals",""),void k(!0);var r=yield u.A.serviceCustomToken.searchTokenByContractAddress({walletId:t,networkId:n.networkId,contractAddress:n.value,isNative:null!=(o=e?.isNative)&&o});if(Array.isArray(r)&&r.length>0&&r[0]?.info){var[a]=r;c.setValue("symbol",a.info.symbol),c.setValue("decimals",new s.A(a.info.decimals).toString()),w.current=a.info,k(!1)}else c.setValue("symbol",""),c.setValue("decimals",""),k(!0)})),function(e){return f.apply(this,arguments)}),300);return(0,r.useEffect)((function(){h({value:d,networkId:i})}),[d,i,h]),{availableNetworks:m,searchedTokenRef:w}}function useAccountInfoForManageToken(){var e,t=(0,r.useCallback)((e=(0,o.A)((function*({accountId:e,networkId:t,isOthersWallet:n,indexedAccountId:o,deriveType:r,selectedNetworkId:s}){var{serviceAccount:a}=u.A,c=!1,i="";try{i=n?(yield a.getAccount({accountId:e,networkId:t})).id:(yield a.getNetworkAccount({accountId:void 0,indexedAccountId:o,networkId:s,deriveType:r})).id,c=!0}catch(e){c=!1}return{hasExistAccountFlag:c,accountIdForNetwork:i}})),function(t){return e.apply(this,arguments)}),[]);return{findAccountInfoForNetwork:t}}function useCheckAccountExist({accountId:e,networkId:t,isOthersWallet:n,indexedAccountId:s,deriveType:a,selectedNetworkIdValue:c}){var{findAccountInfoForNetwork:i}=useAccountInfoForManageToken(),d=(0,r.useCallback)((0,o.A)((function*(){return i({accountId:e,networkId:t,isOthersWallet:n,indexedAccountId:s,deriveType:a,selectedNetworkId:c})})),[e,s,t,n,a,c,i]),{result:u,run:k}=(0,l.yk)((0,o.A)((function*(){var{hasExistAccountFlag:e}=yield d();return e})),[d]);return{hasExistAccount:u,runCheckAccountExist:k,checkAccountIsExist:d}}},3036:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var o=n(324586),r=n(586330),s=n(514041),a=n(724249),c=n(908867),i=n(490343),d=n(848312),u=n(318822),l=n(254491),k=n(757559),f=n(60153),m=n(498356),w=n(208257),h=n(791088),I=n(562428),y=(n(663522),n(831085));function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,o.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ListEmptyComponent({onAddCustomToken:e,isLoading:t}){var n=(0,c.A)();return t?null:(0,y.jsx)(i.Empty,{flex:1,icon:"SearchOutline",title:n.formatMessage({id:l.ETranslations.global_no_results}),description:n.formatMessage({id:l.ETranslations.manage_token_empty_msg}),button:(0,y.jsx)(i.Button,{mt:"$6",size:"medium",variant:"primary",onPress:function(){return e()},children:n.formatMessage({id:l.ETranslations.manage_token_custom_token_button})})})}function ListFooterComponent({searchValue:e,searchResult:t,onAddCustomToken:n}){var o=(0,c.A)();return e.length&&Array.isArray(t)&&t.length?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(i.Divider,{pt:"$5"}),(0,y.jsxs)(i.YStack,{p:"$5",alignItems:"center",children:[(0,y.jsx)(i.SizableText,{textAlign:"center",size:"$bodyMd",maxWidth:void 0,children:o.formatMessage({id:l.ETranslations.manage_token_empty_msg})}),(0,y.jsx)(i.Button,{mt:"$6",size:"medium",variant:"primary",onPress:function(){return n()},children:o.formatMessage({id:l.ETranslations.manage_token_custom_token_button})})]})]}):null}function SkeletonList(){return Array.from({length:5}).map((function(e,t){return(0,y.jsx)(h.c,{children:(0,y.jsxs)(i.XStack,{alignItems:"center",space:"$3",children:[(0,y.jsx)(i.Skeleton,{width:"$10",height:"$10",radius:"round"}),(0,y.jsxs)(i.YStack,{space:"$2",children:[(0,y.jsx)(i.Skeleton,{w:120,h:12,borderRadius:"$3"}),(0,y.jsx)(i.Skeleton,{w:80,h:12,borderRadius:"$3"})]})]})},t)}))}function TokenManagerList({dataSource:e,onAddCustomToken:t,onHiddenToken:n,isLoadingRemoteData:o,isLoadingLocalData:r,networkId:s,isAllNetwork:a,networkMaps:c,checkTokenExistInTokenList:d,searchValue:u,searchResult:l}){var{bottom:k}=(0,i.useSafeAreaInsets)();return o||!e?(0,y.jsx)(SkeletonList,{}):(0,y.jsx)(i.SectionList,{sections:e,renderSectionHeader:function({section:{title:e,data:n}}){return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(i.SizableText,{mt:10,px:"$5",size:"$bodyMd",color:"$textSubdued",children:e}),Array.isArray(n)&&!n.length?(0,y.jsx)(ListEmptyComponent,{onAddCustomToken:t,isLoading:o||!!r}):null]})},keyExtractor:function(e){return e.$key},renderItem:function({item:e}){var o,r,u;return(0,y.jsxs)(h.c,{children:[(0,y.jsx)(I.G,{icon:e.logoURI,networkId:null!=(o=e.networkId)?o:s,isAllNetworks:!0}),(0,y.jsxs)(i.YStack,{flex:1,children:[(0,y.jsxs)(i.XStack,{space:"$2",children:[(0,y.jsx)(i.SizableText,{size:"$bodyLgMedium",color:"$text",children:e.symbol}),a?(0,y.jsx)(i.Badge,{children:null!=(r=c?.[null!=(u=e.networkId)?u:""]?.name)?r:""}):null]}),(0,y.jsx)(i.SizableText,{size:"$bodyMd",color:"$textSubdued",children:e.name})]}),(0,y.jsx)(h.c.IconButton,_objectSpread({disabled:!(!d(e)||!e.isNative),icon:d(e)?"MinusCircleOutline":"PlusCircleOutline",onPress:function(){return d(e)?n(e):t(e)}},d(e)&&{iconProps:{color:"$iconCritical"}}))]})},ListFooterComponent:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(ListFooterComponent,{searchValue:u,searchResult:l,onAddCustomToken:t}),k?(0,y.jsx)(i.Stack,{h:k}):null]}),ListEmptyComponent:(0,y.jsx)(ListEmptyComponent,{onAddCustomToken:t,isLoading:o||!!r}),keyboardDismissMode:"on-drag"})}var g=n(424403),p=n(911998),A=n(384013);var T=n(712784),b=n.n(T);function TokenManagerModal_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function TokenManagerModal_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?TokenManagerModal_ownKeys(Object(n),!0).forEach((function(t){(0,o.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TokenManagerModal_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function TokenManagerModal(){var e,t=(0,c.A)(),n=(0,m.A)(),o=(0,a.lq)(),{walletId:w,isOthersWallet:h,indexedAccountId:I,networkId:T,accountId:v,deriveType:x}=o.params,j=T===(0,d.V$)().onekeyall,{sectionTokens:M,refreshTokenLists:S,isLoadingLocalData:C,networkMaps:_,checkTokenExistInTokenList:O}=function useTokenManagement({networkId:e,accountId:t}){var n=(0,c.A)(),o=e===(0,d.V$)().onekeyall,[a]=(0,A.Cg)(),{result:i,run:u,isLoading:k}=(0,p.yk)((0,r.A)((function*(){var[r,s]=yield Promise.all([f.A.serviceCustomToken.getHiddenTokens({accountId:t,networkId:e,allNetworkAccountId:o?t:void 0}),f.A.serviceCustomToken.getCustomTokens({accountId:t,networkId:e,allNetworkAccountId:o?t:void 0})]),c=[...a.tokens,...s].filter((function(e,t,n){return t===n.findIndex((function(t){return t.networkId===e.networkId&&t.accountId===e.accountId&&t.address===e.address}))})).filter((function(e){return!r.find((function(t){return t.address===e.address&&t.networkId===e.networkId}))})),i=[{title:n.formatMessage({id:l.ETranslations.manage_token_added_token}),data:c}];return r.length&&i.push({title:n.formatMessage({id:l.ETranslations.manage_token_popular_token}),data:r}),{sectionTokens:i,addedTokens:c}})),[a,t,e,o,n],{checkIsFocused:!1,watchLoading:!0}),{result:m}=(0,p.yk)((0,r.A)((function*(){return(yield f.A.serviceNetwork.getAllNetworks()).networks.reduce((function(e,t){return e[t.id]=t,e}),{})})),[],{initResult:{}}),w=(0,s.useCallback)((function(e){return i?.addedTokens?.find((function(t){return t.address===e.address&&t.networkId===e.networkId}))}),[i?.addedTokens]);return{sectionTokens:i?.sectionTokens,tokenList:i?.addedTokens,refreshTokenLists:u,isLoadingLocalData:k,networkMaps:m,checkTokenExistInTokenList:w}}({networkId:T,accountId:v}),{searchValue:E,searchResult:L,isSearchMode:N,setSearchValue:$,isLoadingRemoteData:V}=function useTokenSearch({walletId:e,networkId:t}){var n,[o,a]=(0,s.useState)(!1),[c,i]=(0,s.useState)(""),[d,u]=(0,s.useState)(null),l=(0,s.useRef)(b()((n=(0,r.A)((function*(e){a(!0);try{var t=yield f.A.serviceCustomToken.searchTokenByKeywords({walletId:e.walletId,networkId:e.networkId,keywords:e.searchValue}),n=t?.map((function(e){var t,{price:n,price24h:o,info:r}=e;return{$key:`search__${null!=(t=r.networkId)?t:""}_${r.address}_${r.isNative?"native":"token"}`,address:r.address,decimals:r.decimals,isNative:r.isNative,logoURI:r.logoURI,name:r.name,symbol:r.symbol,riskLevel:r.riskLevel,networkId:r.networkId,price:n,price24h:o}}));u(n)}catch(e){}finally{a(!1)}})),function(e){return n.apply(this,arguments)}),500)).current;(0,s.useEffect)((function(){if(c)return l({walletId:e,networkId:t,searchValue:c}),function(){l.cancel()};u(null)}),[c,t,e,l]);var k=(0,s.useMemo)((function(){return c&&c.length>0}),[c]);return{searchValue:c,searchResult:d,isSearchMode:k,setSearchValue:i,isLoadingRemoteData:o}}({walletId:w,networkId:T}),P=(0,s.useMemo)((function(){return N&&Array.isArray(L)?[{title:"",data:L}]:M}),[N,L,M]),R=(0,s.useRef)(!1),F=(0,s.useCallback)((function(e){n.push(k.jX.AddCustomTokenModal,{walletId:w,isOthersWallet:h,indexedAccountId:I,networkId:T,accountId:v,deriveType:x,token:e,onSuccess:function(){S(),R.current=!0}})}),[n,w,h,I,T,v,x,S]),{findAccountInfoForNetwork:D}=(0,g.Mo)(),z=(0,s.useCallback)((e=(0,r.A)((function*(e){var n,o,{accountIdForNetwork:r}=yield D({accountId:v,networkId:T,isOthersWallet:h,indexedAccountId:I,deriveType:x,selectedNetworkId:null!=(n=e.networkId)?n:T});yield f.A.serviceCustomToken.hideToken({token:TokenManagerModal_objectSpread(TokenManagerModal_objectSpread({},e),{},{accountId:r,networkId:null!=(o=e.networkId)?o:T,allNetworkAccountId:j?v:void 0})}),R.current=!0,setTimeout((function(){S(),i.Toast.success({title:t.formatMessage({id:l.ETranslations.address_book_add_address_toast_delete_success})})}),200)})),function(t){return e.apply(this,arguments)}),[S,v,T,h,I,x,t,j,D]),B=(0,s.useCallback)((function(){return N?null:(0,y.jsx)(i.Button,{variant:"tertiary",onPress:function(){return F()},children:t.formatMessage({id:l.ETranslations.content__custom})})}),[t,N,F]);return(0,y.jsxs)(i.Page,{safeAreaEnabled:!1,onClose:function(){R.current&&u.iL.emit(u.Tu.RefreshTokenList,void 0)},children:[(0,y.jsx)(i.Page.Header,{title:t.formatMessage({id:l.ETranslations.manage_token_title}),headerRight:B}),(0,y.jsxs)(i.Page.Body,{children:[(0,y.jsx)(i.Stack,{px:"$5",pb:"$4",children:(0,y.jsx)(i.SearchBar,{placeholder:t.formatMessage({id:l.ETranslations.token_selector_search_placeholder}),autoFocus:!0,zIndex:20,selectTextOnFocus:!0,value:E,onSearchTextChange:$,onSubmitEditing:function(){}})}),(0,y.jsx)(TokenManagerList,{dataSource:P,onAddCustomToken:F,onHiddenToken:z,isLoadingRemoteData:V,isLoadingLocalData:C,networkId:T,isAllNetwork:j,networkMaps:_,checkTokenExistInTokenList:O,searchValue:E,searchResult:L})]})]})}const v=function TokenManagerModalContainer(){return(0,y.jsx)(w.p,{children:(0,y.jsx)(TokenManagerModal,{})})}}}]);
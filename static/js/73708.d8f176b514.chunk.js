"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[73708],{536612:(e,t,a)=>{a.d(t,{SX:()=>useAppUpdateInfo,sx:()=>useDownloadPackage,x7:()=>useAppChangeLog});var n=a(324586),o=a(586330),s=a(514041),r=a(908867),i=a(490343),l=a(604343),c=a(713132),u=a(254491),d=a(639451),p=a(757559),f=a(584186),g=a(60153),m=a(498356),b=a(911998);function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach((function(t){(0,n.A)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var useAppChangeLog=function(e){var t=(0,b.yk)((function(){return e?g.A.serviceAppUpdate.fetchChangeLog():Promise.resolve(null)}),[e]);return(0,s.useMemo)((function(){return t.result}),[t.result])},useDownloadPackage=function(){var e,t=(0,r.A)();return(0,s.useCallback)((e=(0,o.A)((function*(e){try{yield g.A.serviceAppUpdate.startDownloading();var a=yield(0,d.Xo)(e);yield g.A.serviceAppUpdate.verifyPackage(a),yield Promise.all([(0,d.sB)(a),f.A.wait(3e3)]),yield g.A.serviceAppUpdate.readyToInstall()}catch(e){i.Toast.error({title:t.formatMessage({id:u.ETranslations.global_update_failed})}),g.A.serviceAppUpdate.notifyFailed(e)}})),function(t){return e.apply(this,arguments)}),[t])},useAppUpdateInfo=function(e=!1){var t=(0,r.A)(),[a]=(0,l.useAppUpdatePersistAtom)(),n=(0,m.A)(),o=useDownloadPackage(),f=(0,s.useCallback)((function(){setTimeout((function(){(e?n.pushFullModal:n.pushModal)(p.ry.AppUpdateModal,{screen:p.mk.WhatsNew})}))}),[e,n.pushFullModal,n.pushModal]),b=(0,s.useCallback)((function(e=!1,t){(e?n.pushFullModal:n.pushModal)(p.ry.AppUpdateModal,{screen:p.mk.UpdatePreview,params:_objectSpread({latestVersion:a.latestVersion,isForceUpdate:a.isForceUpdate,autoClose:e},t)})}),[a.isForceUpdate,a.latestVersion,n.pushFullModal,n.pushModal]);(0,s.useEffect)((function(){(0,c.fK)(a)&&f(),a.status===c.ue.downloading&&o(a),g.A.serviceAppUpdate.fetchAppUpdateInfo().then((function(e){e?.isForceUpdate&&(0,c._q)(e.latestVersion,e.status)&&b(!0,e)}))}),[]);var _=(0,s.useCallback)((function(){switch(a.status){case c.ue.notify:case c.ue.downloading:case c.ue.verifying:b(e);break;case c.ue.ready:(0,d.Ed)(a).catch((function(e){i.Toast.error({title:t.formatMessage({id:u.ETranslations.global_update_failed})}),g.A.serviceAppUpdate.notifyFailed(e)}));break;case c.ue.failed:o(a)}}),[a,o,t,e,b]);return(0,s.useMemo)((function(){return{isNeedUpdate:(0,c._q)(a.latestVersion,a.status),data:a,onUpdateAction:_,toUpdatePreviewPage:b,onViewReleaseInfo:f}}),[a,_,f,b])}},903469:(e,t,a)=>{a.d(t,{A:()=>BackupListLoading});var n=a(490343),o=a(831085);function BackupListLoading(){return(0,o.jsxs)(n.Stack,{flex:1,px:"$5",space:"$2",pt:"$5",children:[(0,o.jsx)(n.Skeleton,{h:"$6",w:"70%"}),(0,o.jsx)(n.Skeleton,{h:"$6",w:"100%"}),(0,o.jsx)(n.Skeleton,{h:"$6",w:"70%"}),(0,o.jsx)(n.Skeleton,{h:"$6",w:"100%"})]})}},573708:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Detail});var n=a(324586),o=a(586330),s=a(514041),r=a(724249),i=a(908867),l=a(302722),c=a.n(l),u=a(490343),d=a(896666),p=a(60153),f=a(791088),g=a(536612),m=a(593827),b=a(498356),_=a(911998),y=a(847164),v=a(254491),h=a(213644),k=a(663522),w=a(757559),O=a(567807),T=a(903469),j=a(831085);function DeleteBackupDialogFooter({filename:e,callback:t}){var a=(0,i.A)(),[n,r]=(0,s.useState)(!1);return(0,j.jsx)(u.Dialog.Footer,{confirmButtonProps:{loading:n},tone:"destructive",onConfirmText:a.formatMessage({id:v.ETranslations.global_delete}),onConfirm:(0,o.A)((function*(){try{r(!0),yield p.A.serviceCloudBackup.removeBackup(e),t?.(),u.Toast.message({title:a.formatMessage({id:v.ETranslations.backup_backup_deleted})})}finally{r(!1)}}))})}var A=a(882115);function RestorePasswordVerify(){var e=(0,i.A)(),[t,a]=(0,s.useState)(!0);return(0,j.jsx)(u.Dialog.Form,{formProps:{values:{password:""}},children:(0,j.jsx)(u.Dialog.FormField,{name:"password",rules:{required:{value:!0,message:e.formatMessage({id:v.ETranslations.auth_enter_your_password})},onChange:function(){}},children:(0,j.jsx)(u.Input,{autoFocus:!0,size:"large",placeholder:e.formatMessage({id:v.ETranslations.auth_enter_your_password}),flex:1,keyboardType:(0,A.V)(!t),secureTextEntry:t,addOns:[{iconName:t?"EyeOffOutline":"EyeOutline",onPress:function(){a(!t)},testID:"password-eye-"+(t?"off":"on")}]})})})}function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach((function(t){(0,n.A)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Detail(){var e,t,a=(0,i.A)(),n=function useRestorePasswordVerifyDialog(){var e=(0,i.A)(),t=(0,s.useCallback)((function(){return new Promise((function(t,a){return u.Dialog.confirm({icon:"InfoCircleOutline",title:e.formatMessage({id:v.ETranslations.backup_import_data}),description:e.formatMessage({id:v.ETranslations.backup_verify_app_password_to_import_data}),renderContent:(0,j.jsx)(RestorePasswordVerify,{}),onConfirmText:e.formatMessage({id:v.ETranslations.global_import}),onConfirm:function(e){var a,n=e.getForm()?.getValues(),o=null!=(a=n?.password)?a:"";o.length<=0||t(o)},onClose:function(){a(e.formatMessage({id:v.ETranslations.global_cancel}))}})}))}),[e]);return(0,s.useMemo)((function(){return{show:t}}),[t])}(),l=function useDeleteBackupDialog(){var e=(0,i.A)(),t=(0,s.useCallback)((function(t){return new Promise((function(a){u.Dialog.show({title:e.formatMessage({id:v.ETranslations.backup_delete_this_backup}),icon:"DeleteOutline",description:e.formatMessage({id:k.Ay.isNativeAndroid?v.ETranslations.backup_file_permanently_deleted_android:v.ETranslations.backup_file_permanently_deleted}),tone:"destructive",renderContent:(0,j.jsx)(DeleteBackupDialogFooter,{filename:t,callback:a})})}))}),[e]);return(0,s.useMemo)((function(){return{show:t}}),[t])}(),A=(0,b.A)(),M=(0,r.lq)(),{item:{filename:E,backupTime:P}}=M.params,D=(0,O.Yq)(new Date(P)),[x,S]=(0,s.useState)(0),[C,$]=(0,s.useState)(!1),U=(0,g.SX)(),L=(0,s.useCallback)((function(e){var t,n,o;return[Object.values(e.HDWallets).length>0&&{title:a.formatMessage({id:v.ETranslations.global_app_wallet}),data:Object.values(e.HDWallets).map((function(e){return{title:e.name,detail:a.formatMessage({id:v.ETranslations.global_number_accounts},{number:e.indexedAccountUUIDs.length}),walletAvatar:e.avatar,infoList:[a.formatMessage({id:v.ETranslations.global_recovery_phrase}),a.formatMessage({id:v.ETranslations.global_wallet_avatar}),a.formatMessage({id:v.ETranslations.global_names_of_wallets_and_accounts})],footerDescription:a.formatMessage({id:v.ETranslations.backup_only_accounts_with_addresses_will_be_backed_up})}}))},Object.values(e.importedAccounts).length+Object.values(e.watchingAccounts).length>0&&{title:a.formatMessage({id:v.ETranslations.global_other_wallet}),data:[Object.values(e.importedAccounts).length>0&&{title:a.formatMessage({id:v.ETranslations.global_private_key}),detail:a.formatMessage({id:v.ETranslations.global_number_accounts},{number:Object.keys(e.importedAccounts).length}),icon:"PasswordOutline",infoList:[a.formatMessage({id:v.ETranslations.global_private_key}),a.formatMessage({id:v.ETranslations.global_account_name})]},Object.values(e.watchingAccounts).length>0&&{title:a.formatMessage({id:v.ETranslations.global_watchlist}),detail:a.formatMessage({id:v.ETranslations.global_number_accounts},{number:Object.keys(e.watchingAccounts).length}),icon:"EyeOutline",infoList:[a.formatMessage({id:v.ETranslations.global_address}),a.formatMessage({id:v.ETranslations.global_account_name})]}].filter((function(e){return e}))},Object.keys(e.contacts).length>0&&{title:a.formatMessage({id:v.ETranslations.backup_address_book_labels}),data:[Object.keys(e.contacts).length>0&&{title:a.formatMessage({id:v.ETranslations.settings_address_book}),detail:a.formatMessage({id:v.ETranslations.global_number_items},{number:Object.keys(e.contacts).length}),icon:"BookOpenOutline",infoList:[a.formatMessage({id:v.ETranslations.global_address}),a.formatMessage({id:v.ETranslations.global_name}),a.formatMessage({id:v.ETranslations.global_network_type})]}].filter((function(e){return e}))},(null!=(t=e?.discoverBookmarks?.length)?t:0)>0&&{title:a.formatMessage({id:v.ETranslations.global_browser}),data:[(null!=(n=e?.discoverBookmarks?.length)?n:0)>0&&{title:a.formatMessage({id:v.ETranslations.browser_bookmark}),detail:a.formatMessage({id:v.ETranslations.global_number_items},{number:null!=(o=e?.discoverBookmarks?.length)?o:0}),icon:"BookmarkOutline",infoList:[a.formatMessage({id:v.ETranslations.global_url}),a.formatMessage({id:v.ETranslations.global_name})]}].filter((function(e){return e}))}].filter((function(e){return e}))}),[a]),B=(0,_.yk)((0,o.A)((function*(){var e=yield p.A.serviceCloudBackup.getBackupDiffListWithFilename(E),t=L(e.alreadyOnDevice),a=L(e.notOnDevice);return _objectSpread(_objectSpread({},e),{},{alreadyOnDeviceSectionList:t,notOnDeviceSectionList:a})})),[E,L]).result,F=(0,s.useMemo)((function(){if(!B)return[];var e=0===x?B.notOnDeviceSectionList:B.alreadyOnDeviceSectionList;return null!=e?e:[]}),[x,B]),I=(0,s.useCallback)((function(){var e;C||u.ActionList.show({title:D,items:[{label:a.formatMessage({id:v.ETranslations.global_delete}),icon:"DeleteOutline",destructive:!0,onPress:(e=(0,o.A)((function*(){yield l.show(E),A.pop()})),function onPress(){return e.apply(this,arguments)})}]})}),[a,l,D,E,A,C]),R=(0,s.useCallback)((function(){return(0,j.jsx)(d.v$,{icon:"DotVerOutline",onPress:I})}),[I]),V=(0,s.useCallback)((t=(0,o.A)((function*(e){if(B){var{password:t}=yield p.A.servicePassword.promptPasswordVerify();return p.A.serviceCloudBackup.restoreFromPrivateBackup({privateString:B.backupData.privateData,notOnDevice:B.notOnDevice,localPassword:t,remotePassword:null!=e?e:t})}})),function(e){return t.apply(this,arguments)}),[B]),W=(0,s.useCallback)((0,o.A)((function*(){var e;if(c().gt(null!=(e=B?.backupData.appVersion)?e:"",null!="5.1.0"?"5.1.0":"1.0.0"))u.Dialog.show({icon:"InfoCircleOutline",title:a.formatMessage({id:v.ETranslations.backup_upgrade_required}),description:a.formatMessage({id:v.ETranslations.backup_please_upgrade_app_to_import_data}),onConfirmText:a.formatMessage({id:v.ETranslations.global_upgrade}),onConfirm:function(){U.toUpdatePreviewPage()}});else{$(!0);try{var{isOnboardingDone:t}=yield p.A.serviceOnboarding.isOnboardingDone(),o=yield V();if(o===y.d.WRONG_PASSWORD){var s=yield n.show();o=yield V(yield p.A.servicePassword.encodeSensitiveText({text:s}))}o===y.d.WRONG_PASSWORD?u.Toast.error({title:v.ETranslations.auth_error_password_incorrect}):o===y.d.UNKNOWN_ERROR?u.Toast.error({title:o}):(u.Toast.success({title:a.formatMessage({id:v.ETranslations.backup_backup_imported})}),t?A.pop():A.navigate(w.WP.Main))}catch(e){var r;u.Toast.error({title:`${null!=(r=e?.message)?r:e}`})}finally{$(!1)}h.U.account.wallet.importWallet({importMethod:"cloud"})}})),[a,n,B,A,U,V]);return(0,j.jsxs)(u.Page,{children:[(0,j.jsx)(u.Page.Header,{title:D,headerRight:R}),(0,j.jsxs)(u.Page.Body,{children:[(0,j.jsx)(u.Stack,{m:"$5",children:(0,j.jsx)(u.SegmentControl,{fullWidth:!0,value:x,onChange:function(e){S(e)},options:[{label:a.formatMessage({id:v.ETranslations.backup_off_device},{number:null!=(e=B?.diffCount)?e:0}),value:0},{label:a.formatMessage({id:v.ETranslations.backup_on_device}),value:1}]})}),B?(0,j.jsx)(u.SectionList,{sections:F,renderItem:function({item:e}){return(0,j.jsx)(f.c,{title:e.title,renderIcon:e.walletAvatar?(0,j.jsx)(m.L,{wallet:{avatarInfo:e.walletAvatar}}):(0,j.jsx)(u.Stack,{bg:"$bgStrong",p:"$2",borderRadius:"$3",children:(0,j.jsx)(u.Icon,{name:e.icon,size:"$6",color:"$icon"})}),children:(0,j.jsxs)(u.XStack,{space:"$1",onPress:function(){u.ActionList.show({title:a.formatMessage({id:v.ETranslations.backup_encrypted_backup_contents}),items:e.infoList.map((function(e){return{label:`  •${k.Ay.isNativeAndroid?"\t\t":"\t"}${e}`}})),renderItems:e?.footerDescription?function(){return(0,j.jsx)(u.SizableText,{mx:"$3",my:"$3",size:"$bodyMd",color:"$textSubdued",children:e?.footerDescription})}:void 0})},children:[(0,j.jsx)(f.c.Text,{secondary:e.detail,align:"right"}),(0,j.jsx)(u.Icon,{name:"InfoCircleOutline",color:"$iconSubdued",size:"small",bg:"transparent"})]})})},estimatedItemSize:"$16",ListEmptyComponent:(0,j.jsx)(u.Empty,{icon:"SearchOutline",title:a.formatMessage({id:v.ETranslations.backup_no_data}),description:a.formatMessage({id:v.ETranslations.backup_data_already_present})}),renderSectionHeader:function({section:e}){return(0,j.jsx)(u.SectionList.SectionHeader,{title:e.title})}}):(0,j.jsx)(T.A,{}),(0,j.jsx)(u.Button,{m:"$5",borderRadius:"$3",py:"$3",variant:"primary",loading:C,disabled:!B||B.notOnDeviceSectionList.length<=0,onPress:W,children:a.formatMessage({id:v.ETranslations.global_import})})]})]})}},639451:(e,t,a)=>{a.d(t,{Ed:()=>c,Xo:()=>i,sB:()=>l,xf:()=>useDownloadProgress});var n,o,s,r=a(586330),i=(n=(0,r.A)((function*(){return{}})),function downloadPackage(){return n.apply(this,arguments)}),l=(o=(0,r.A)((function*(){})),function verifyPackage(){return o.apply(this,arguments)}),c=(s=(0,r.A)((function*(){})),function installPackage(){return s.apply(this,arguments)}),useDownloadProgress=function(){return 0}}}]);
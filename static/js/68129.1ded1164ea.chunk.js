"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[68129],{82506:(e,t,r)=>{r.d(t,{d:()=>useDebounce});var n=r(578104);function useDebounce(e,t,r){var[o]=(0,n.d7)(e,t,r);return o}},471230:(e,t,r)=>{r.d(t,{YG:()=>v,U9:()=>o.U});r(490343),r(791088),r(757559);var n=r(498356);r(831085);var o=r(952954),a=r(324586),i=r(586330),l=r(514041),s=r(908867),d=r(604343),u=r(318822),c=(r(254491),r(663522),r(584186)),f=r(60153),p=r(131397),b=r(621591);function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){(0,a.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m=0,g=!1,y=!1;var v=(0,l.memo)((function OnboardingOnMountCmp(){(0,s.A)();var e=(0,p.t1)(),t=(0,n.A)(),r=(0,b.D)(),[o,a]=(0,d.useV4migrationPersistAtom)(),v=o?.downgradeWarningConfirmed;(0,l.useRef)(v).current=v;var h=(0,l.useCallback)((0,i.A)((function*(){(yield f.A.serviceV4Migration.checkShouldMigrateV4OnMount())&&(g||(g=!0,yield f.A.serviceV4Migration.migrateBaseSettings()))})),[]),w=(0,l.useCallback)((0,i.A)((function*({checkingV4Migration:t}={}){try{if(t)if(yield f.A.serviceV4Migration.checkShouldMigrateV4OnMount()){if(yield h(),yield c.A.wait(600),!y){y=!0,yield r.navigateToV4MigrationPage({isAutoStartOnMount:!0});var n=Date.now();n-m>3e3&&(m=n,a((function(e){return _objectSpread(_objectSpread({},e),{},{v4migrationAutoStartCount:(e.v4migrationAutoStartCount||0)+1})})))}return}}catch(e){}var{isOnboardingDone:o}=yield f.A.serviceOnboarding.isOnboardingDone();o||e({isFullModal:!0,params:{showCloseButton:!0}})})),[h,a,e,r]),k=(0,l.useCallback)((0,i.A)((function*(){yield w({checkingV4Migration:!0})})),[w,h,a]);return(0,l.useEffect)((function(){}),[]),(0,l.useEffect)((function(){}),[a]),(0,l.useEffect)((function(){}),[t]),(0,l.useEffect)((function(){}),[r]),(0,l.useEffect)((function(){k()}),[k]),(0,l.useEffect)((function(){var fn=function(){w({checkingV4Migration:!1})};return u.iL.on(u.Tu.WalletClear,fn),function(){u.iL.off(u.Tu.WalletClear,fn)}}),[w]),null}))},68129:(e,t,r)=>{r.r(t),r.d(t,{default:()=>j});var n=r(586330),o=r(514041),a=r(908867),i=r(490343),l=r(60153),s=r(325809),d=r(575995),u=r(660395),c=r(370968),f=r(498356),p=r(82506),b=r(911998),m=r(162616),g=r(147882),y=r(848312),v=r(181447),h=r(254491),w=r(213644),k=r(714191),A=r(471230),x=r(831085),E=function(e){return e.Address="Address",e.PublicKey="PublicKey",e}(E||{}),FormDeriveTypeInput=function({networkId:e,deriveInfoItems:t,fieldName:r}){var n=(0,a.A)();return(0,x.jsx)(i.Stack,{mt:"$2",children:(0,x.jsx)(i.Form.Field,{label:n.formatMessage({id:h.ETranslations.derivation_path}),name:r,children:(0,x.jsx)(d.l$,{networkId:e,enabledItems:t,renderTrigger:function({label:e}){return(0,x.jsxs)(i.Stack,{userSelect:"none",flexDirection:"row",px:"$3.5",py:"$2.5",borderWidth:1,borderColor:"$borderStrong",borderRadius:"$3",$gtMd:{px:"$3",py:"$1.5",borderRadius:"$2"},borderCurve:"continuous",hoverStyle:{bg:"$bgHover"},pressStyle:{bg:"$bgActive"},children:[(0,x.jsx)(i.SizableText,{flex:1,children:e}),(0,x.jsx)(i.Icon,{name:"ChevronDownSmallOutline",color:"$iconSubdued",mr:"$-0.5"})]})}})})})};function ImportAddress(){var e=(0,a.A)(),t=(0,i.useMedia)(),r=(0,f.A)(),{result:d}=(0,b.yk)((0,n.A)((function*(){var e=yield l.A.serviceNetwork.getPublicKeyExportOrWatchingAccountEnabledNetworks(),t=e.map((function(e){return e.network.id})),r=e.filter((function(e){return e.publicKeyExportEnabled})).map((function(e){return e.network.id})),n=e.filter((function(e){return e.watchingAccountEnabled})).map((function(e){return e.network.id}));return{networkIds:t,publicKeyExportEnabled:new Set(r),watchingAccountEnabled:new Set(n)}})),[],{initResult:{networkIds:[],publicKeyExportEnabled:new Set([]),watchingAccountEnabled:new Set([])}}),k=(0,m.z$)(),[j,I]=(0,o.useState)(E.Address),{activeAccount:{network:M}}=(0,u.w)({num:0}),{clearText:S}=(0,i.useClipboard)(),_=(0,i.useForm)({values:{networkId:M?.id&&M.id!==(0,y.V$)().onekeyall?M?.id:(0,y.V$)().btc,deriveType:void 0,publicKeyValue:"",addressValue:{raw:"",resolved:void 0}},mode:"onChange",reValidateMode:"onBlur"}),{setValue:O,control:T}=_,[V,P]=(0,o.useState)(),C=(0,o.useRef)(!1),K=(0,i.useFormWatch)({control:T,name:"networkId"}),$=(0,i.useFormWatch)({control:T,name:"publicKeyValue"}),F=(0,i.useFormWatch)({control:T,name:"addressValue"}),D=(0,p.d)($.trim(),600),W=(0,o.useCallback)((0,n.A)((function*(){if(O("deriveType",void 0),D&&K){var e=yield l.A.servicePassword.encodeSensitiveText({text:D});try{if(!d.publicKeyExportEnabled.has(K))throw new Error(`Network not supported: ${K}`);var t=yield l.A.serviceAccount.validateGeneralInputOfImporting({input:e,networkId:K,validateXpub:!0});P(t),S()}catch(e){P({isValid:!1})}}else P(void 0)})),[S,D,K,O,d.publicKeyExportEnabled]);(0,o.useEffect)((function(){(0,n.A)((function*(){try{C.current=!0,yield W()}finally{C.current=!1}}))()}),[W]);var N,{start:R}=(0,g.A)(),B=(_.watch("deriveType"),(0,o.useMemo)((function(){return j===E.Address?!F.pending&&_.formState.isValid:V?.isValid}),[j,F.pending,V,_.formState])),z=(0,o.useMemo)((function(){return K&&d.publicKeyExportEnabled.has(K)}),[K,d.publicKeyExportEnabled]),H=(0,o.useMemo)((function(){return j===E.PublicKey&&z}),[j,z]);return(0,x.jsxs)(i.Page,{children:[(0,x.jsx)(i.Page.Header,{title:e.formatMessage({id:h.ETranslations.global_import_address})}),(0,x.jsxs)(i.Page.Body,{px:"$5",children:[(0,x.jsxs)(i.Form,{form:_,children:[(0,x.jsx)(i.Form.Field,{label:e.formatMessage({id:h.ETranslations.global_network}),name:"networkId",children:(0,x.jsx)(s.YS,{networkIds:d.networkIds})}),z?(0,x.jsx)(i.SegmentControl,{fullWidth:!0,value:j,onChange:function(e){I(e)},options:[{label:e.formatMessage({id:h.ETranslations.global_address}),value:E.Address},{label:e.formatMessage({id:h.ETranslations.global_public_key}),value:E.PublicKey}]}):null,H?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(i.Form.Field,{label:e.formatMessage({id:h.ETranslations.global_public_key}),name:"publicKeyValue",children:(0,x.jsx)(i.Input,{secureTextEntry:!1,placeholder:e.formatMessage({id:h.ETranslations.form_public_key_placeholder}),testID:"import-address-input",size:t.gtMd?"medium":"large",addOns:[{iconName:"ScanOutline",onPress:(N=(0,n.A)((function*(){var e=yield R({handlers:[],autoHandleResult:!1});_.setValue("publicKeyValue",e.raw)})),function onPress(){return N.apply(this,arguments)})}]})}),V?.deriveInfoItems?(0,x.jsx)(FormDeriveTypeInput,{fieldName:"deriveType",networkId:_.getValues().networkId||"",deriveInfoItems:V?.deriveInfoItems||[]}):null,(0,x.jsx)(x.Fragment,{children:V&&!V?.isValid&&D?(0,x.jsx)(i.SizableText,{color:"$textCritical",children:e.formatMessage({id:h.ETranslations.form_public_key_error_invalid})}):null})]}):null,H?null:(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(i.Form.Field,{label:e.formatMessage({id:h.ETranslations.global_address}),name:"addressValue",rules:{validate:(0,c.j)({defaultErrorMessage:e.formatMessage({id:h.ETranslations.form_address_error_invalid})})},children:(0,x.jsx)(c.N,{placeholder:e.formatMessage({id:h.ETranslations.form_address_placeholder}),networkId:null!=K?K:"",testID:"import-address-input"})})})]}),(0,x.jsx)(A.U9,{list:[{title:e.formatMessage({id:h.ETranslations.faq_watched_account}),description:e.formatMessage({id:h.ETranslations.faq_watched_account_desc})}]}),null]}),(0,x.jsx)(i.Page.Footer,{confirmButtonProps:{disabled:!B},onConfirm:(0,n.A)((function*(){var t;yield _.handleSubmit((t=(0,n.A)((function*(t){var n,o,a,s,d=H?{input:null!=(n=t.publicKeyValue)?n:"",networkId:null!=(o=t.networkId)?o:"",deriveType:t.deriveType}:{input:null!=(a=t.addressValue.resolved)?a:"",networkId:null!=(s=t.networkId)?s:""},u=yield l.A.serviceAccount.addWatchingAccount(d),c=u?.accounts?.[0]?.id;c&&i.Toast.success({title:e.formatMessage({id:h.ETranslations.global_success})}),k.current.updateSelectedAccountForSingletonAccount({num:0,networkId:t.networkId,walletId:v.Hk,othersWalletAccountId:c}),r.popStack(),w.U.account.wallet.importWallet({importMethod:"address"})})),function(e){return t.apply(this,arguments)}))()}))})]})}const j=function ImportAddressPage(){return(0,x.jsx)(s.b8,{config:{sceneName:k.Zs.home},enabledNum:[0],children:(0,x.jsx)(ImportAddress,{})})}}}]);